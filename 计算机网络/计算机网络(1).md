# 计算机网络体系结构

## 考纲内容

- 计算机网络概述
  计算机网络的概念、组成与功能；计算机网络的分类
  计算机网络的性能指标
- 计算机网络体系结构与参考模型
  计算机网络分层结构；计算机网络协议、接口、服务的概念
  ISO/OSI参考模型和TCP/IP模型

本章主要介绍计算机网络体系结构的基本概念。重点掌握网络的分层结构（包括5层和7层结构），尤其是ISO/OSI参考模型各层的功能及相关协议、接口和服务等概念。掌握有关网络的各种性能指标，特别是时延、带宽、速率和吞吐量等的计算

## 计算机网络的概述

### 计算机网络的概念

一般认为，计算机网络是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。简而言之，计算机网络就是一些互连的、自治的计算机系统的集合体

计算机网络的**`资源`**主要指**`计算机硬件、计算机软件与数据`**
通常的计算机硬件有：服务器、路由器、通信线路、用户计算机、Web服务器、数据库服务器、文件服务器
通常的计算机软件有：计算机操作系统、数据库、应用软件

**广义观点**
只要是能实现远程信息处理的系统或能进一步达到资源共享的系统，都是计算机网络

**资源共享观点**
计算机网络是“以能够相互共享西元的方式互连起来的自治计算机系统的集合“。该定义包含下面三层含义：

- 目的：资源共享
- 组成单元：分布在不同地理位置的多台独立的”自治计算机“
- 网络中的计算机必须遵循的统一规则：网络协议

**用户透明性观点**
存在一个能为用户自动管理资源的网络操作系统，它能够调用用户所需要的资源，而整个网络就像一个大的计算机系统一样对用户是透明的。用户无需了解网络的存在、资源的位置信息。用户透明性观点的定义描述了一个分布式系统，是网络未来发展追求的目标

### 计算机网络的组成

从**`物理组成`**上看
一个完整的计算机网络主要有**`硬件、软件、协议`**三大部分组成，缺一不可

- 硬件主要由**`主机`**(端系统)、**`通信链路`**(如双绞线、光纤)、**`交换设备`**(如路由器、交换机等)和**`通信处理机`**(如网卡)等组成
- 软件主要包括各种**`实现资源共享的软件`**和方便用户使用的各种**`工具软件`**(如网络操作系统、邮政手法程序、FTP程序、聊天程序等)。**`软件部分多属于应用层`**
- **`协议是计算机的核心`**。协议**`规定了网络传输数据时所遵循的规范`**

从**`工作方式`**上看
计算机网络可分为**`边缘部分`**和**`核心部分`**

- 边缘部分由所连接到因特网上、供用户直接使用的主机组成，用来进行**`通信`**(如传输数据、音频或视频)和**`共享资源`**
- 核心部分由大量的网络和连接这些网络的路由器组成，为**`边缘部分提供连通信和交换服务`**

从**`功能组成`**来看
计算机网络从**逻辑功能**上是由**`通信子网`**和**`资源子网`**组成

- 通信子网由各种**`传输介质`**、**`通信设备`**和**`相应的网络协议`**组成，**`使网络具有数据传输、交换、控制和存储的能力，实现联网计算机之间的数据通信`**
  如数据链路层的**网桥、交换机**；网络层的**路由器**
- 资源子网是**`实现资源共性功能的设备及软件的集合`**，**`向网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源的服务`**

### 计算机网络的功能

1、**数据通信**

是计算机网络**`最基本和最重要的功能`**，用来实现联网计算机之间各种信息的传输，并将分散在不同地理位置的计算机联系起来，进行统一的调配、控制和管理
例如：文件传输、电子邮件等应用，离开了计算机网络将无法实现

2、**资源共享**

使计算机网络中的资源互通有无、分工协作，从而**`极大提高硬件资源、软件资源和数据资源的利用率`**

3、**分布式处理**

当计算机网络中的某个计算机系统负荷过重时，可以将其处理的某个复杂任务分配给网络中的其他计算机，从而利用空间计算机资源以**`提高整个系统的利用率`**

4、**提高可靠新**

计算机网络中的各台计算机可以通过网络互为替代机

5、**负载均衡**

将工作任务均衡地分配给计算机网络中的各台计算机

### 计算机网络的分类

1、按**`分布范围`**分类

- 广域网(WAN)。广域网的**`任务是提供长距离通信`**，运送主机所发送的数据。**`广域网是因特网的核心部分`**，具有较大的通信容量。**`使用交换技术`**
- 城域网(MAN)。城域网**`大多采用以太网技术`**，有时也常并入局域网的范围讨论
- 局域网(LAN)。局域网一半用危机或工作站通过告诉线路相连，覆盖范围较小。**`使用广播技术`**
- 个人区域网(PAN)。个人区域网指在个人工作的地方将消费电子设备用无线技术连接起来的网络

```
注：
若中央处理器之间的距离非常近，则一半成为多处理器系统，而不称为计算机网络
局域网和广域网的差异不仅在于它们所覆盖的范围不同，还主要在于它们所使用的 -协议不同-
广域网与局域网的互连是通过 -路由器- 实现的
```

2、按**`传输技术`**分类

- 广播式网络。所有**`联网计算机都共享一个公共通信通道`**。当一台计算机利用共享通信信道发送报文分组时，所有其他的计算机都会”收听“到这个分组。接受到该分组的计算机网**`通过检查目的地址来决定是否接收该分组`**。`局域网基本上都采用广播式通信技术，广域网中的无线、卫星通信网络、也采用广播式通信技术`
- 点对点网络。**`每条物理线路连接一对计算机`**。若通信的两台主机之间**`没有直接连接的线路`**，则它们之间的**`分组传输就要通过中间节点进行接收、存储和转发，直至目的结点`**

```
注：
是否采用分子存储转发与路由选择机制是点对点式网络与广播式网络的重要区别，广域网基本都属于点对点网络
广播式网络采用共享广播信道，可以包药网络层，不存在路由选择问题，需要服务访问点
```

3、按**`拓扑结构`**分类

网络拓扑结构是指由网中结点(路由器、主机等)与通信线路(网线)之间的几何关系表示的网络结构，**`主要指通信子网的拓扑结构`**
主要分为**`总线型、星型、环形和网状型`**等。**`线型和环形网络多用于局域网，网状网络多用于广域网`**

![image-20231123122718412](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231123122718412.png)

- 总线型。用单根传输线把计算机连接起来
  优点：建网容易、增/减结点方便、节省线路
  缺点：重负载时通信效率不高、总线任意一处对故障敏感
- 星型。每个终端或计算机都以单独的线路与中央设备相连
  优点：便于集中控制和管理，因为端用户之间的通信必须经过中央设备
  缺点：成本高、中央设备对故障敏感
- 环形。所有计算机接口设备连接成一个环。环可以是单环，也可以是双环，环中信号是单向传输的
- 网状型。每个结点至少有两条路径与其他结点相连，**多用在广域网中**。有规则型和非规则型两种
  优点：可靠性高
  缺点：控制复杂、线路成本高

4、按**`使用者`**分类

- 公用网。指电信公司出资建造的大型网络
- 专用网。某部门为满足单位特殊业务的需要而建造的网络

5、按**交换技术**分类

交换技术是指各台主机之间、各通信设备之间或主机与通信设备之间**`为交换信息所采用的数据格式和交换装置的方式`**

- 电路交换网络。在源结点和目的结点之间建立一条专用的通路用于传送数据，包括**`建立连接、传输数据和断开连接`**三个阶段
  特点：整个报文的比特流连续地从远点直达终点
  优点：数据直接传送、时延小
  缺点：线路利用率低、不能充分利用线路容量、不便于进行差错控制
- 报文交换网络。用户数据加上源地址、目的地址、校验码等辅助信息，然后封装成报文。整个报文传送到相邻结点，全部存储后，再转发给下一个结点，重复这一过程直到到达目的结点。每个报文可以单独选择到达目的结点的路径
  特点：整个报文先传送到相邻结点，全部存储后查找转发表，转发到下一个结点
  优点：可以较为充分地利用线路容量，可以实现不同链路之间不同数据传输速率的转换，可以实现格式转换，可以实现一对多、多对多id访问，可以实现差错控制
  缺点：增大了资源开销。增加了缓冲时延，需要额外的控制机制来保证多个报文的顺序不乱序，缓冲区难以管理
- 分组交换网络。原理：将数据分成较短的固定长度的数据块，在每个数据块中加上目的地址、源地址等辅助信息组分成组(包)，以存储-转发方式传输
  特点：单个分组传送到相邻结点，存储后查找转发表，转发到下一个结点
  优点：除具备报文交换网络的优点外，分组交换网络缓冲易于管理，包的平均时延更小，网络占用的平均缓冲区更少，更易于标准化，更适合应用
  缺点：附加信息开销大

6、按**`传输介质`**分类

传输介质可分为有线和无线两大类，因此网络可以分为有线网络和无线网络
有限网络又分为双绞线网络、同轴电缆网络等
无线网络又分为蓝牙、微波、无线电等类型

### 计算机网络的性能指标

**1、速率、带宽、吞吐量**

- 速率：连接到计算机网络上的主机在数字信道上传送数据的速率。也称**`数据传输速率`**、**`数据率`**或**`比特流`**
  单位：b/s（比特/秒）或bit/s。有时数据率较高时，可以用kb/s(k=10^3)、Mb/s(M=10^6)、Gb/s(10^9)表示
  在计算机网络中，通常**`把最高数据传输速率成为带宽`**
- 带宽：表示网络的通信线路所能传送数据的能力，是数字信道所能传送的“最高数据传输率”的同义语
  单位：b/s（比特/秒）
  即网络设备所支持的贵高速度
- 吞吐量：指单位时间内通过某个网络(或信道、接口)的数据量
  单位：b/s（比特/秒）
  受网络带宽或网络额定速率的限制

`实际传输速率一定会比带宽小，带宽是上限，吞吐量是所有链路速率的和`

**2、时延、时延带宽积、往返时延RTT、利用率**

- 时延：指数据(报文/分组/比特流)从网络(或链路)的一端传送到另一端所需的时间。也叫延迟或迟延
  单位：s（秒）
  时延由四部分组成，分别为：**发送时延、传播时延、排队时延、处理时延**
  发送时延：从发送分组的第一个比特算起，到分组的最后一个比特流发送完毕所需的时间
  	**`发送时延 = 数据长度 / 信道带宽`**
  传播时延：一个比特从链路的一端传播到另一端所需的时间
  	**`传播时延 = 信道长度 / 电磁波在信道上的传输速率`**
  排队时延：分组在进入路由器后要先在输入队列中排队等待处理
  	路由器确定转发端口后，还要在输出队列中排队等待转发，这就产生了排队时延
  处理时延：数据在交换结点为存储转发而进行的一些必要的处理所花费的时间

- 时延带宽积：发送端发送第一个比特即将到达终点时，发送端已经发出了多少比特。也称为**`以比特为单位的链路长度`**
  单位：b（比特）

  ​	**`时延带宽积 = 传播时延 x 信道带宽`**

- 往返时间RTT：指发送端发出一个短分组，到发送端收到来自接收端的确认(接收方收到数据后立即发送确认)，总共经历的时延
  RTT越大，在收到确认之前，可以发送的数据越多

  ​	`RTT = 传播时延 x 2 + 末端处理时间(其他时延)`

- 信道利用率：指出某一信道由百分之多少的时间时由数据通过的

  ​	**`信道利用率 = 有数据通过的时间 / 总时间`**
  网络利用率：信道利用率的加权平均值

## 计算机网络体系结构与参考模型

### 分层结构、协议、接口、服务

**`网络模型分层的目的`**

```
增加功能之间的独立性
降低协议设计和调试过程的复杂性
便于对网络进行研究、实现和维护
促进标准化工作，如提供标准语言、定义标准界面
```

**`分层的基本原则`**

```
每层都实现一种相对独立的功能，降低大系统的复杂度
各层之间界面自然清晰，易于理解，相互交流尽可能少
各层功能的精确定义独立于具体的实现方法，可以采用最合适的技术来实现
保持下层对上层的独立性，上层单向使用下层提供的服务
整个分层结构应能促进标准化工作
```

**`分层的含义`**

```
1、第n层的实体不仅要使用第n-1层的服务来实现自身定义的功能，还要向第n+1层提供本层的服务，该服务是第n层及其下面各层提供的服务总和
2、最低层只提供服务，是整个层次结构的基础；中间各层既是下一层的服务使用者，又是上一层的服务提供者；最高层面向用户提供服务
3、上一层只能通过相邻层间的接口使用下一层的服务，而不能调用其他层的服务；下一层所提供服务的实现细节对上一层透明
4、两台主机通信时，对等层在逻辑上有一条直接信道，表现为不经过下层就把消息传送到对方
```

由于分层后各层之间相对独立，灵活性好，因而分层的体系结构易于更新、易于调试、易于抽象、易于标准化
但层次越多，有些功能在不同层中难免重复出现

实体：第n层中的活动元素通常称为第n层实体。同一层的实体叫对等实体
协议：为进行网络中的**`对等实体`**数据交换而建立的规则、标准或约定。在实体之间是**`水平`**的关系
	语法：规定传输数据的格式
	语义：规定索要完成的功能
	同步：规定各种操作的顺序
接口(访问服务点SAP)：上层使用下层服务的入口
服务：下层为相邻上层提供的功能调用。在实体之间是**`垂直`**的关系

**`第n层实体实现的服务为n + 1层所利用`**
第n层称为`服务提供者`，第n + 1层则服务于用户

在计算机网络体系结构的各个层次中，每个报文都分为两部分：一是数据部分，即SDU；二是控制信息部分，即PCI，它们共同组成PDU
服务数据单元(SDU)：为完成用户所要求的功能而应传送的数据
协议控制信息(PCI)：控制协议操作的信息
协议数据单元(PDU)：对等层次之间传送的数据单元

每层的协议数据单元都有一个通俗的名称：

```
物理层的PDU：比特
数据链路层的PDU：帧
网络层的PDU：分组
传输层的PDU：报文段
```

在各层间传输数据时，把从第n+1层收到的PDU作为第n层的SDU，加上第n层的PCI，就变成了第n层的PDU，交给n-1层后作为SDU发送。接收方接收时做相反的处理
**`n-SDU + n-PCI = n-PDU = (n - 1)-SDU`**

![image-20231123212946778](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231123212946778.png)

一些概念：

```
网络体系结构时从功能上描述计算机网络结构
计算机网络体系结构简称网络体系结构时分层结构
每层遵循某个/些网络协议以完成本层功能
计算机网络体系结构是计算机网络的各层及其协议的集合
第n层再向n+1层提供服务时，此服务不仅包含第m层本身的功能，还包含由下层服务提供的功能
仅仅在相邻层间有接口，且所提供服务的具体实现细节对上一层完全屏蔽
体系结构时抽象的，而实现是指能运行的一些软件和硬件
```

### OSI参考模型

目的：为了支持**`异构网络系统的互联互通`**
国际标准化组织(ISO)于1984年提出了**`开放系统互连参考模型(OSI/RM)`**
自下而上依次为：**`物理层、数据链路层、网络层、传输层、会话层、表示层、应用层`**（物数网传会表应）
**`第三层统称为通信子网`**，它是为了联网而附加的通信设备，**`完成数据传输的功能`**
**`高三层统称为资源子网`**，它相当于计算机系统，**`完成数据处理的功能`**
**`传输层承上启下`**

![image-20231124100124889](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231124100124889.png)

注：下面三层的通信必须借助中继系统才能进行，它们之间的通信称为点到点之间的通信；而上面四层的通信是不需要使用到中继系统的，它们之间的通信称为端到端之间的通信。**`高层用户可以直接进行端到端的数据连接，从而忽略通信子网的存在`**

#### 应用层

应用层是OSI参考模型里面的最高层，是**`用户与网络的界面`**
应用层为特定类型的网络应用提供访问OSI参考模型环境的手段
因为用户的实际应用多种多样，这就要求应用层采用不同的应用协议来解决不同类型的应用要求，换句话说，即**`所有能和用户交互产生网络流量的程序`**都属于应用层

`典型应用层服务`：文件传输(FTP)、电子邮件(SMTP)、万维网(HTTP)

#### 表示层

表示层主要处理在两个通信系统中交换信息的表示方式(语义和语法)
不同机器采用的编码和表示方法不同，使用的数据结构也不同。为了使不同表示方法的数据和信息之间能互相交换，表示层采用抽象的标准方法定义数据结构，并采用标准的编码形式

`表示层的功能`

```
1、数据格式变换
2、数据加密解密
3、数据压缩和恢复
```

`主要协议`：JPEG、ASCII

#### 会话层

会话层允许不同主机上的各个进程之间进行会话
会话层**`利用传输层提供的端到端的服务，向表示层提供它的增值服务`**
会话层**`向表示层实体/用户进程提供建立连接并在连接上有序地传输数据`**，这就是会话，也称为**`建立同步`**(SYN)

`会话层功能`

```
1、负责管理主机间的会话进程，包括建立、管理及种植进程间的会话
2、可以使用校验点使通信会话在通信失效时从校验点继续服务通信，实现数据同步	适用于传输大文件
```

`主要协议`：ADSP、ASP

#### 传输层

传输层主要负责主机中两个进程的通信，即**`端到端的通信`**，传输单位是**`报文段(TCP)`**或**`用户数据(UDP)`**

`传输层功能`

```
1、为端到端连接提供可靠的传输服务和不可靠传输服务
2、为端到端连接提供流量控制、差错控制、服务质量、数据传输管理等服务
3、分用和复用。复用是指多个应用层进程可同时使用下面传输层的服务；分用是指传输层把收到的信息分别交付给上面应用层中相应的进程
```

`主要协议`：**TCP、UDP**

#### 网络层

因特网是一个很大的网络，它由大量异构网络通过路由器相互连接起来。因特网的主要网络层协议使无连接的网际协议(IP)和许多路由选择协议，因此网络层也叫**网际层**或**IP层**

传输单位：**`数据报`**
主要任务：**`把分组从远端传到目的端，为分组交换网上的不同主机提供通信服务`**

(数据报和分组的关系：当数据报过长的时候就可以进行切割，切割之后的数据包就叫分组，可以使传输更灵活)

`网络层功能`

```
1、路由选择：根据算法选择最佳路径
2、流量控制：限制发送方发速度来控制数据传输速率
3、差错控制：检查通信的两结点是否发生了错误，能纠错就纠错，不能纠错就丢弃。方法有如奇偶校验码
4、拥塞控制：如果所有结点都来不及接收分组，而要丢弃大量分组的话，网络就处于拥塞状态。缓解这种拥塞就是拥塞控制

可同时提供无连接服务和面向连接服务
```

`主要协议`：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

#### 数据链路层

传输单位：**`帧`**
主要任务：**`把网络层传下来的数据包组装成帧`**

`数据链路层功能`：**`能够保证数据正确的顺序和完整性`**

```
1、成帧：定义帧的开始和结束
2、差错控制：帧错或位错时可以被检测出来并进行处理
3、流量控制：协调两个结点的速率
4、访问(接入)控制：控制对信道的访问，也可以被称为物理寻址
```

`主要协议`：SDLC、HDLC、PPP、STP

#### 物理层

传输单位：**`比特`**
主要任务：**`在物理媒体上实现比特流的透明传输`**

透明传输：不管所传数据时什么样的比特组合，都应当能够在链路上传送	(来什么发什么)

`物理层功能`

```
1、定义接口特性：接口特定的参数
2、定义传输模式：单工(一个方向)、半双工(双向不同时)、双工(双向同时)
3、定义传输速率
4、比特同步
5、比特编码
```

`主要协议`：Rj45、802.3

注：传输信息所用的一些物理媒介，如双绞线、光缆、无线信道等，并不在物理层协议之内，而在物理层协议下面

### TCP/IP参考模型

OSI/RM与TCP/IP

![image-20231125105353119](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231125105353119.png)

网络接口层的功能类似于OSI参考模型的物理层和数据链路层。它**`表示与物理网络的接口`**。但实际上TCP/IP本身并未真正描述这一部分，只是指出主机必须使用某种协议与网络连接，以便在其上传递IP分组
物理接口层的作用是**`从主机或结点接收IP分组，并将它们发送到指定的物理网络上`**

网际层(主机-主机)是TCP/IP的**`关键部分`**，功能类似于OSI参考模型的网络层。网际层将分组发往任何网络，并为之独立地选择合适的路由，但它**`不保证各个分组有序的到达`**，各个分组的有序交付由高层负责
网际层**`定义了标准的分组格式和协议`**，即IP。现在多使用的是IPv4和IPv6

传输层(应用-应用或进程-进程)类似于OSI参考模型中的传输层，使得发送端和目的端主机上的对等实体进行会话
传输层主要使用以下协议：
	1、传输控制协议(**TCP**)：它是**面向对象**的，单位是**报文段**，能够**`提供可靠的交付`**
	2、用户数据报协议(**UDP**)：它是无连接的，单位是用户**数据报**，**`不保证提供可靠交付`**，只能提供**`尽最大努力交付`**

应用层(用户-用户)包含所有的高层协议，如虚拟终端协议(**Telnet**)、文件传输协议(**FTP**)、域名解析服务(**DNS**)、电子邮件协议(**SMTP**)和超文本传输协议(**HTTP**)。应用层的**`服务访问点`**也称**`用户界面`**

**`IP协议是因特网中的核心协议`**

`OSI参考模型与TCP/IP参考模型的相同点`

```
1、都采用分层的体系结构，将庞大且复杂的问题划分为若干骄傲容易处理的、范围较小的问题，而且分层的功能也大体相似
2、都基于独立的协议栈的概念
3、可以实现异构网络互连，实现不同计算机之间的通信
```

`OSI参考模型与TCP/IP参考模型的不同点`

```
1、OSI定义三点：服务、协议、接口
2、OSI出现在协议之前，不偏向特定协议，适用性良好；而TCP/IP正好相反，模型实际上是对已有协议的描述，因此不会出现协议不能匹配模型的情况
3、TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次；OSI参考模型最初指考虑哦那个一种标准的公用数据网将各种不同的系统互连
4、OSI参考模型与TCP/IP的通信方式有所不同
	ISO参考模型网络层支持无连接和面向连接的通信，但在传输层仅有面向连接的通信
	TCP/IP认为可靠性是端到端的问题，因此网际层仅有一种无连接的通信方式，但传输层支持无连接和面向连接两种模式
```

面向连接分为三阶段：1、建立连接，在此阶段发出一个建立连接的请求。2、只有在连接成功建立之后，才能开始数据传输。3、当数据传输完毕，必须释放连接
面向无连接没有这么多阶段，它直接进行数据传输

### 5层参考模型

综合了OSI和TCP/IP的优点
**`物理层、数据链路层、网络层、传输层、应用层`**

![image-20231125110937177](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231125110937177.png)

`5层参考模型的数据封装与解封装`

![image-20231125111236260](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231125111236260.png)

## 疑难点

**计算机网络与分布式计算机系统的主要区别是什么**

分布式系统最主要的特点是，整个系统中的各个计算机用户都是透明的。用户通过输入命令就可以运行程序，但用户并不知道哪台计算机在为它运行程序。操作系统为用户选择一台最合适的计算机来运行其程序，并将运行的结果传送到合适的地方

计算机望楼哦则与之不同，用户必须先登录欲运行程序的计算机，然后按照计算机的地址，将程序通过计算机网络传送到该计算机中运行，最后根据用户命令将结果传送到指定的计算机中。二者的区别主要是软件的不同

**为什么一个网络协议必须考虑到各种不利的情况**

因为网络协议如果不全面考虑不利的情况，那么当情况发生变化时，协议就会保持理想状态，一直等下去。所以判断一个计算机网络是否正确，不能只看在正常情况下是否正确，还必须非常仔细地检查协议是否能应付各种异常情况

**端到端通信和点到点通信有什么区别**

从本质上说，由物理层、数据链路层和网络层组成的通信子网为网络环境中的主机提供点到的服务，而传输层为网络中的主机提供端到端的通信
直接相连的结点之间的通信称为点到点通信，它只提供一台及其到另一台机器之间的通信，不涉及程序或进程的概念。同时，点到点通信并不能保证数据传输的可靠新，也不能说明源主机与目的主机之间是哪两个进程在通信，这些工作都是由传输层来完成的
端到端通信建立在点到点通信的基础上，它是由一段段的点到点通信信道构成的，是比点到点通信更高一级的通信方式，以完成应用程序(进程)之间的通信。端是指用户程序的端口，端口号标识了应用层中不同的进程

在两台计算机之间传输一个文件有两种可行的策略：
**`第一种策略把文件截成分组，接收方逐个确认分组，但整体就整体而言，文件没有得到确认`**
**`第二种策略不确认单个分组，但当文件全部收到后，对整个文件予以确认`**
请讨论两种方式的优缺点

如果网络容易丢失，那么对每个分组注意进行确认较好，此时仅重传丢失的分组
如果网络高度可靠，那么在不发生差错的情况下，仅在整个文件传送的接吻发送一次确认，从而减少了确认次数，节省了带宽
不过，即使只有单个分组丢失，也要重传整个文件

**服务和协议有何区别，有何联系**

协议是控制两个对等实体之间通信的规则和集合。在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务，而要实现本层协议，还需要使用下一层提供的服务
协议和服务概念的区分：
	1、**`协议的实现保证了能够向上一层提供服务`**。本层的服务用户只能看见服务而无法看见下面的协议，即下面的协议对上面的服务用户是透明的
	2、**`协议是水平的`**。即协议是控制两个对等实体之间的通信规则。但**`服务是垂直的`**，即服务是由下层通过层间接口向上提供的

# 物理层

## 考纲内容

- 通信基础
  信道、信号、带宽、码元、波特、速率、信源、与信宿等基本概念
  奈奎斯特定理与香农定理；编码与调制
  电路交换、报文交换与分组交换；数据包与虚电路
- 介质传输
  双绞线、同轴电缆、光纤与无线传播介质；物理层接口的特性
- 物理层设备
  中继器；集线器

物理层考虑的是怎样才能在连接各台计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。本章概念较多，易出选择题，且涉及一些通信原理。复习时应抓住重点，如奈奎斯特定理和香农定理的应用、编码与调制技术、数据交换方式，以及电路交换、报文交换技术等

## 通信基础

### 物理层接口特性

物理层解决如何在连接各种计算机的传输媒介上**`传输数据比特流`**，而不是指具体的传输媒体
主要任务：确定与传输媒体**`接口`**有关的一些特性(**`定义标准`**)

- 机械特性
  定义物理连接的特性，规定物理连接时所采用的规格、接口形状、**`引线形状`**、**`引脚数量`**和排列情况
- 电气特性
  规定传输二进制位时，线路上信号的**`电压范围`**、阻抗匹配、传输**`速率`**和**`距离`**限制等
- 功能特性
  指明某条线上出现的某一**`电平表示何种意义`**，接口不见的信号线的用途
- 规程特性(过程特性)
  定义各条物理线路的工作**`规程和时序`**关系

### 典型数据通信模型

![image-20231127103059653](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127103059653.png)

### 数据通信相关术语

通信的**`目的`**：**`传送消息`**（消息可以是语、文字、图像、视频等）
数据：传送信息的实体，通常是有意义的负号序列。**`数据通信`**指在不同计算机之间传输表示信息的0、1序列的过程
信号：数据的电气/电磁的表现，是数据在传输过程中的**`存在形式`**
		数字信号/离散信号：代表消息的参数的取值是离散的![image-20231127103438784](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127103438784.png)
		模拟信号/连续信号：代表消息的参数的取值是连续的![image-20231127103449005](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127103449005.png)
信源：产生和发送数据的源头
信宿：接收数据的重点
信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道
		按照**`传输信号`**分：**`模拟信道`**(传送模拟信号)、**`数字信道`**(传送数字信号)
		按照**`传输介质`**分：无线信道、有线信道

---

码元：用一个**`固定时长`**的**`信号波形`**(数字脉冲)，代表不同离散数值的基本波形，时数字信号的计量单位，这个时长内的信号称为k进制码元，而该时长称为码元宽度。当码元的离散状态由M个时(M大于2)，此时码元为M进制码元
	**`1码元可以携带多个比特的信息量`**。在使用二进制编码时，只有两种不同的码元，一种代表0，一种代表1
速率：也叫数据率，是指数据的**`传输速率`**，表示单位时间内传输的数据量。可以用**`码元传输速率`**和**`信息传输速率`**来表示
	码元传输速率：(码元速率、波形速率、调制速率、符号速率等)，表示单位时间内数字通信系统所传输的码元个数(**`脉冲个数或信号变化的次数`**)，单位为**波特**(Baud)，1波特表示数字通信系统每秒传输一个码元。**`码元速率与进制数无关`**，只与**`码元长度T`**有关：**`速率=(1/T)B`**
	信息传输速率：(信息速率、比特率等)，表示单位时间内数字通信系统传输的二进制码元个数(即比特数)，单位是**`比特/秒`**(b/s)。**`传输速率与比特有关`**：**速率=码元速率(log~2~^N^)**	N为进制数，如四进制码元等

码元速率和信息速率的**关系**：一个码元携带**`n bit`**信息量，则**`M Baud`**码元传输速率所对应信息传输速率为**`Mn bit/s`**

带宽：
	在**`模拟信号系统中`**：当输入的信号频率高或低到一定程度，使得系统的输出功率成为输入功率的一半时，最高频率和最低频率间的差值就代表了系统的通频带宽，其单位为**`赫兹(Hz)`**
	在**`数字设备中`**：表示在单位时间内从网络中的某一点到另一点所能通过的**`"最高数据率"/单位时间内通过链路的数量`**，常用来表示网络的通信线路所能传输数据的能力。单位是**`比特每秒(b/s)`**
	拥有更宽的带宽，也就有更大的信息运送能力
信道带宽：信道能通过的最高频率和最低频率之差

### 三种通信方式

从通信双方信息的交互方式看，可以有三种基本方式：

- 单工通信
  只有一个方向的通信而没有反向的交互，仅需要**`一条`**信道，如广播
- 半双工通信/双向交替通信
  通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，需要**`两条`**信道，如对讲机
- 全双工通信/双向同时通信
  通信双方可以同时发送和接受信息，也需要**`两条`**信道，如打电话

一句话概括一下就是`单只有一个方向，只有一条信道；半双不能同时，两条信道；全双能同时，两条信道`

### 数据传输方式

- 串行传输
  一比特一比特的按照时间顺序传输
  **`速度慢、费用低、适合远距离通信`**
- 并行传输
  若干比特通过多条通信信道同时传输
  **`速度块、费用高、适合近距离`**（如用于计算机内部数据的传输）

### 实现同步的传输/通信方式

- 同步传输
  数据的传送时以一个**`数据区块`**为单位，因此同步传输又称为区块传输
  在传送数据时，需先送出1个或多个同步字符，在送出整批的数据
- 异步传输
  将比特**`分成小组`**进行传送。发送方可以在任何时刻发送这些比特组，而接收方不知道它们会在什么时候到达
  传送数据时，加上一个字符起始位和一个字符终止位

## 奈奎斯特定理与香农定理

**失真**：

![image-20231127150806111](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127150806111.png)

影响失真程度的因素：

```
1、码元传输速率：速率越快，失真越严重
2、信号传输距离：距离越远，衰减越久，失真越严重
3、噪声干扰
4、传输媒体质量
```

失真的一种现象：**`码间串扰`**--**`接收端`**收到的信号波形**`失去了码元之间清晰界限`**的现象

**`1、奈奎斯特定理`**

在**`理想低通(无噪声，带宽受限)`**条件下，为了避免码间串扰，极限码元传输速率为**`2W Baud`**，W是**`信道带宽`**，单位是**`Hz`**

​	**数据极限传输速率 = 2Wlog~2~V**		单位为**`b/s`**

其中V为码元的离散电平数目(即多少种不同的码元)，用**log~2~V**来表示所需要的**`进制位数`**

- 在任何信道中，**`码元传输速率是有上限的`**。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别称为不可能
- 信道的**`频带越宽`**(即能通过的信号高频分量越多)，就**`可以用更高的速率进行码元的有效传输`**
- **`奈奎斯特定理给出了码元传输速率的限制，但并没有对信息传输速率给出限制`**
- 由于码元的传输速率受奈奎斯特定理的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法

**`2、香农定理`**

**`噪声`**存在于所有的电子设备和通信信道中。由于噪声随机产生，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误。但是噪声的影响是相对的，若信号较强，那么噪声影响相对较小。因此，**`信噪比`**就很重要

​	`信噪比=信号的平均功率/噪声的平均功率`	常记作**`S/N`**，单位为**`分贝(dB)`**，一般题目会给出来
​	**信噪比(dB) = 10log~10~(S/N)**

要注意的是题目给出的如果是没有单位的比值，即为S/N；如果带了单位就需要带入公式把**`S/N`**的值求出来才能继续

香农定理：在带宽首先且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值

​	**数据极限传输速率 = Wlog~2~(+S/N)**		单位为**`b/s`**

- 信道的**`带宽`**或信道中的**`信噪比越大`**，则信息的**`极限传输速率就越高`**
- 对一定的传输带宽和一定的信噪比，信息传输速率的上限就能确定了
- 只要**`信息的传输速率低于信道的极限传输速率`**，就一定能找到某种方法来实现**`无差错的传输`**
- 香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少
- 从香农定理可以看出，若信道带宽W或信噪比S/N没有上限，那么信道的极限信息传输速率也就没有上限

奈奎斯特定理在**`带宽受限`**，**`无噪声`**的情况下；香农定理在**`带宽受限`**，**`有噪声`**的情况下
按照奈奎斯特定理想要提高数据率，就要提高带宽或采用更好的编码技术
按照香农定理想要提高数据率，就要提高带宽或信噪比

## 编码与调制

信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道

**基带信号**：将数字信号1和0直接用两种不同的电压表示，再送到**`数字信道`**上去传输(**`基带传输`**)
	**`来自信源`**的信号，像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号
	基带信号就是发出的**`直接表达了要传输的信息的信号`**，比如我们说话的声波就是基带信号

**宽带信号**：将基带信号进行调制后形成的频分复用模拟信号，再传送到**`模拟信道`**上去传输(**`宽带传输`**)
	把基带信号经过**`载波调制`**后，把信号的**`频率范围搬移`**到**`较高的频段`**以便在信道中传输
	(即仅在一端频率范围内能够通过信道)

注：**`这里最好记住的是基带信号在数字信道上传输；宽带信号在模拟信道上传输`**

在传输距离比较近时，计算机网络采用**`基带传输`**方式(近距离衰减小，从而信号内容不易发生变化)
在传输距离比较远时，计算机网络采用**`宽带传输`**方式(远距离衰减大，即使信号变化大也能最后过滤出来基带信号)

---

数据无论时数字的还是模拟的，为了传输的目的**`都必须转变成信号`**
把**`数据转变为模拟信号`**的过程称为**`调制`**
把**`数据转变为数字信号`**的过程称为**`编码`**

对于数据也有不同的种类

- **`数字信号`**可以通过**`数字发送器`**来**`编码`**成**`数字信号`**；通过**`调制器`**来**`调制`**成**`模拟信号`**
- **`模拟数据`**可以通过**`PCM编码器`**来**`编码`**成**`数字信号`**；通过**`放大器调制器`**来**`调制`**成**`模拟信号`**

### 数字数据编码为数字信号

数字数据编码用于**`基带传输`**，即在基本不改变数字数据信号频率的情况下，直接传输数字信号。具体用什么样的数字信号表示0及用什么样的数字信号表示1就是所谓的**`编码`**，常见编码有一下几种：

![image-20231127213141501](C:/Users/16282/AppData/Roaming/Typora/typora-user-images/image-20231127213141501.png)

- 归零编码(RZ)：
  信号电平在一个码元之内都要恢复0的这种编码方式
- 非归零编码(NRZ)：
  高1低0
  编码容易实现，但没有检错功能，且无法判断一个码元的开始和结束，以至于**`收发双方难以保持同步`**
- 反向不归零编码(NRZI)：
  信号电平翻转表示0，信号电平不变表示1
- 曼彻斯特编码
  将一个码元分成两个相等的间隔，前一个间隔为低电平后一个间隔为高电平表示码元1；码元0正好相反，也可以采用相反的规定(前低后高和前高后低表示两种不同的电平)
  该编码的特点是：在每一个码元的中间出现电平跳变，位中间的跳变既作**`时钟信号`**(可用于同步)，又作**`数据信号`**，但它所栈的**`频带宽度是原始的基带宽度的两倍`**
  每一个码元都被调成两个电平，所以**`数据传输速率只有调制速率的1/2`**
  **`以太网使用的编码方式就是曼彻斯特编码，每个信号起始边界作为始终信号有利于同步`**
- 差分曼彻斯特编码
  同1异0
  **`常用于局域网传输`**，规则为：若码元为1，则前半个码元的电平相同，若为0，则相反
  该编码的特点：在每个码元的中间，都有一次电平的跳转，**`可以实现自同步`**，且**`抗干扰性强`**于曼彻斯特编码
- 4B/5B编码
  比特流中插入额外的比特以打破一连串0或1，就是用5个比特来编码4个比特的数据，之后再传给接收方，因此称为4B/5B。编码效率为80％
  只采用16种对应16中不同的4位码，其他的16种作为控制码(帧的开始和结束，线路的状态信息等)或保留

### 数字数据调制位模拟信号

数字数据调制技术再发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应调制解调器的调制和解调过程

![image-20231127213621857](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127213621857.png)

- 幅移键控(ASK)：调幅。通过改变载波信号的**`振幅`**来表示数字信号1和0，而载波的频率和相位都不改变
  比较容易实现，但抗干扰能力差

- 频移键控(FSK)：调频。通过改变载波信号的**`频率`**来表示数字信号1和0，而载波的振幅和相位都不改变
  容易实现，抗干扰能力强，目前应用较为广泛

- 相移键控(PSK)：调相。通过改变载波信号的**`相位`**来表示数字信号1和0，而载波的振幅和频率都不改变
  又分为绝对调相和相对调相

- 正交振幅调制(QAM)：在**`频率相同的前提下`**，将ASK与PSK结合起来，形成叠加信号
  设波特率为B，采用m个相位，每个相位有n种振幅，则该QAM技术的数据传输速率R为：

  ​	**R = Blog~2~(mn)**		单位为**`b/s`**

### 模拟数据编码为数字信号

计算机内部处理的是二进制数据，处理的都是**`数字音频`**，所以需要将模拟音频通过采样、量化转换成有限个数字表示的离散序列(即实现**`音频数字化`**)
最典型的例子就是对音频信号进行编码的脉码调制(**`PCM`**)，在计算机应用中，能够达到**`最高保真水平`**的就是PCM编码。它主要包括三步：**`抽样、量化、编码`**

- 抽样：对模拟信号周期性扫描，把时间上连续的信号变成时间上离散的信号
  为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采用定理进行采样：**f~采样频率~ ≥ 2f~信号最高频率~**
- 量化：把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值，并抽取整数，这就把连续的电平幅值转换为离散的数字量
- 编码：把量化的结果转换为与之对应的二进制编码

![image-20231127215453307](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231127215453307.png)

### 模拟数据调制为模拟信号

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源
在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式
模拟的声音数据是加载到模拟的载波信号中传输的

## 数据交换方式

![image-20231128212243064](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231128212243064.png)

### 电路交换

在进行数据传输前，两个结点之间必须先建立一条专用(双方独占)的物理通信路径(由通信双方之间的交换设备和链路逐段连接而成)，该路径可能经过许多中间结点

原理：在数据传输期间，源节点与目的结点之间有一条由中间结点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持

分为三个阶段：**`连接建立(呼叫/电路建立)、数据传输(通信)、连接释放(拆除电路)`**

特点：**`独占资源`**，**`用户始终占用端到端的固定传输带宽`**。适用于远程批处理信息传输或系统间实时性要求高的大量数据传输情况

`电路交换优点`

```
1、传输时延小
2、数据顺序传送，无失序问题
3、实时性强，双方一点建立物理通路，便可以实时通信，适用于交互式会话类通信
4、全双工通信，没有冲突，通信双方有不同的信道，不会争用物理信道
5、适用于模拟信号和数字信号
6、控制简单，电路的交换设备及控制较简单
```

`电路交换的缺点`

```
1、建立连接时间长
2、线路独占，即使通信线路空闲，也不能供其他用户使用，信道使用效率低
3、灵活性差，双方连接通路中的任何一点除了故障，必须重新建立连接，不适应突发性通信
4、无数据存储能力，难以平滑通信量
5、电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互进行通信
6、无法发现与纠正传输差错，难以在通信过程中进行差错控制
```

电路建立后，除源结点和目的结点外，电路上的任何结点都采取"直通方式"接收数据和发送数据，即**`不会存在存储转发所耗费的时间`**

### 报文交换

报文：报文是网络中交换与传输的数据单元，即站点**`一次性要发送的数据块`**。报文包含了将要发送的完整的数据信息，其长短很不一致，长度不限且可变。**`报文中携带有目标地址、源地址等信息`**

报文交换原理：无需再两个站点之间建立一条专用通路，其数据传输的单位是报文，传送过程采用**`存储转发`**方式

报文交换流程：

```
1、发送端发送报文到交换设备中，每个结点收下整个报文后，暂存报文并检查有无错误
2、当所需要的输出电路空闲时，利用路由信息(寻找最佳路径)找到下一个结点地址，传送给下一个结点
3、交换设备把对应的报文转发给接收端，完成报文交换
```

**`在两个通信用户间的其他路线，可传输其他用户的报文，不像电路交换那样必须占用端到端的全部信道`**

`报文交换的优点`

```
1、无需建立连接，无建立连接时延，用户可随时发送报文
2、动态分配路线，动态选择报文通过的最佳路径，可以平滑通信量
3、提高线路可靠性，某条传输路径发生故障，可重新选择另一条路径传输
4、提高线路利用率，通信双方在不同的时间一段一段地部分占有这条物理通道，多个报文可以共享信道
5、提供多目标服务：一个报文可同时发往多个目的地址
6、在存储转发中容易实现代码转换和速率匹配，针织收发双方可以不同时处于可用状态。这样就便于类型、规格和速度不同的计算机之间进行通信
```

`报文交换缺点`

```
1、实时性差，不适合传送实时或交互式业务的数据。数据进入交换结点后要经历存储转发过程，从而引起转发时延
2、只适用于数字信号
3、由于报文长度没有限制，而每个中间结点都要完整地接收传来的整个报文，当输出线路不空闲时，还可能要存储几个完成报文等待转发，要求网络中每个结点有较大的缓冲区。为了降低成本，减少结点的缓冲存储器容量，有时要把等待转发的报文存在磁盘上，进一步增加了传送时延
```

### 分组交换

分组：大多数计算机网络都不饿能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作分组

分组交换的原理：分组交换与报文交换的工作方式基本相同，都采用存储转发方式，形式上的主要差别在于，分组交换网中**`要限制所传输的数据单位的长度`**，一般为128B。发送结点首先对从终端设备送来的数据报文进行接收、存储，而后将报文划分成一定长度的分组，并以分组为单位进行传输和交换。接收结点将收到的分组组装成信息或报文

分组交换流程:

```
1、在发送端对于大数据，先把大数据快分组为小数据块，并在每个小数据块上添加控制信息(即源和目的地址、编号)，使数据变为一个一个的分组，再发送到交换设备中
2、差错检测、路由选择
3、接收端接收分组，按照控制信息中的编号按顺序解码合并小数据块，最终形成大数据，从而完成转发
```

`分组交换的优点`

```
1、无建立时延，无需为通信双方预先建立一条专用通信线路，用户可随时发送分组
2、线路利用率高，通信双方在不同的时间一段一段地部分占有这条物理通道，多个分组可以共享信道
3、简化了存储管理。因为分组的长度固定，相应的缓冲区的大小也戈丁，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易
4、加速传输，后一个分组的存储可以和前一个分组的转发并行操作；传输一个分组比一根报文所需缓冲区小，减少了等待发送时间
5、减少出错几率和重发数据量，提高可靠性，减少传输时延
分组短小，适用于计算机之间突发式数据通信
```

`分组交换的缺点`

```
1、尽管分组交换比报文交换的传输时延少，但仍存在存储转发时延，而且其结点交换机必须具有更强的处理能力
2、每个分组都要加控制信息，一定程度上降低了通信效率，增加了处理的时间
3、当分组交换采用数据报服务时，可能出现时序、丢失或重复分组，分组到达目的结点时，要对分组按照编号进行排序等工作，增加了麻烦。若采用虚电路服务，虽无失序问题，但有呼叫建立、数据传输和虚电路释放三个过程
```

### 数据交换方式的选择

- **`传送数据量大`**，且**`传送时间远大于呼叫`**时，选择**`电路交换`**。电路交换传输时延最小
- 当端到端的通路由**`多段的链路组成`**时，采用**`分组交换`**传送数据较为合适
- 从信道利用率上看，**`报文交换和分组交换优于电路交换`**，其中**`分组交换比报文交换的时延小`**，尤其适合于计算机之间的**`突发式的数据通信`**

`比较分组交换和报文交换，说明分组交换的优点`

```
报文交换与分组交换的原理如下：用户数据加上源地址、目的地址、长度、校验码等辅助信息后，封装成PDU，发给下一个结点。下一个结点收到后先暂存报文，待输出线路空闲时再转发给下一个结点，重复该过程知道到达目的结点。每个PDU可单独选择到达目的结点的路径
不同之处在于：分组交换生成的PDU的长短较短且是固定的，而报文交换生成的PDU的长度是不固定的。正式这一差别使得分组交换具有独特的优点：1、缓冲区易于管理；2、分组的平均延迟更小，网络中占用的平均缓冲区更少；3、更易标准化；4、更适合应用
因此现在主流网络基本上都可视为分组交换网络
```

---

### 数据报方式和虚电路方式

分组交换根据其通信子网向端点系统提供的服务，还可进一步分为**`面向连接的虚电路方式`**和**`无连接的数据报方式`**。这两种服务方式**`都由网络层提供`**

**数据报方式**

![image-20231128213220504](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231128213220504.png)

- 源主机A**`将报文分成多个分组`**，一次发送到直接相连的结点A
- 结点A收到分组后，对每个分组进行**`差错检测`**和**`路由选择`**，不同分组的下一跳结点可能不同
- 结点C收到分组P1后，对分组P1进行差错检测，若正确则向结点A发送确认星系，结点A收到结点C确认后则丢弃分组P1副本
- 依次类推直至所有分组到达目的主机B

`数据报方式的特点`

- **`数据报方式`**为**`网络层`**提供**`无连接服务`**(不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组传输路径可能不同)。发送方可随时发送分组，网络中的结点可随时接收分组
- 同一报文的不同分组达到目的结点时可能发生乱序、重复与丢失
- 每个分组在传输过程中都必须携带源地址和目的地址，以及分组号
- 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组
- 网络具有冗余路径，当某一交换结点或一端链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，**`对故障的适应能力强`**，**`适用于突发性通信，不适于长报文、会话式通信`**
- **`存储转发时的延时小`**，提高了网络的吞吐量
- 收发双方不独占某条链路，**`资源利用率较高`**

**虚电路方式**

虚电路将数据报方式和电路交换方式结合，发挥两者优点

![image-20231128214749241](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231128214749241.png)

虚电路：一条源主机到目的主机类似于电路的路径(**`逻辑连接`**)，路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路的信息

虚电路方式原理：**`建立连接(虚电路建立)、数据传输、释放连接(虚电路释放)`**

- 源主机发送`呼叫请求`分组并收到`呼叫应答`分组后才算建立连接
- 数据传输每个分组携带**`虚电路号`**，分组号、检验和等控制信息
- 源主机发送`释放请求`分组以拆除虚电路

`虚电路方式的特点`

- **`虚电路方式`**为**`网络层`**提供**`连接服务`**(首先为分组的传输确定传输路径~(建立连接)~，然后沿该路径~(连接)~传输系列分组，系列分组传输路径相同，传输结束后拆除连接)。源节点与目的的结点之间建立一条逻辑连接，而非实际物理连接
- 一次通信的所有分组都通过虚电路顺序传送，分组不需携带源地址、目的地址等信息，包含**`虚电路号`**，相对数据包方式**`开销小`**，同一报文的不同分组到达目的结点时**`不会乱序、重复或丢失`**
- 分组通过虚电路上的每个结点时，结点**`只进行差错检测，不需进行路由选择`**
- 每个结点可能与多个结点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同的进程服务
- 致命弱点：当网络中的某个结点或某条链路出故障而彻底失效时，则所有经过该节点或该链路的虚电路将遭到破坏

**数据包与虚电路方式的对比**

![](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231128215811648.png)

## 传输介质及分类

传输介质也称传输媒体/传输媒介，它就是数据传输系统中在发送设备和接收设备之间的**`物理道路`**
**`传输媒体并不是物理层`**。传输媒体在物理层的下面，因为物理层是体系结构的第一层，因此有时称传输媒体为第0层
在传输媒体中传输的是信号，但传输媒体并不知道所传输的信号代表什么意思
但物理层规定了**`电气特性`**，因此能够识别所传送的比特流

**`物理层是傻瓜层，传输媒体连傻瓜都不如`**

传输介质可分为**`导向性介质和非导向性传输介质`**

- 导向性传输介质：电磁波被导向沿着固体媒介(铜线、光纤等)传播
  1、双绞线：是最古老、又最常用的传输介质，它由**`两根`**采用一定规则并排**`绞合`**的、相互绝缘的**`铜导线`**组成
  	**`绞合可以减少对相邻导线的电磁干扰`**
  	![image-20231129221723985](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231129221723985.png)
  	特点：
  		价格**`便宜`**，在局域网和传统电话网中普遍使用
  		模拟传输和数字传输都可以使用双绞线
  		通信距离一般为几公里到数十公里
  		距离远时，对于**`模拟传输`**，用**`放大器`**放大衰减的信号，对于**`数字传输`**，用**`中继器`**将失真的信号**`整形`**
  2、同轴电缆：由导体铜质芯线、绝缘层、网状编织屏蔽层和塑料外层构成。按特性阻抗数值的不同，通常将同轴电缆分为两类：50Ω同轴电缆和75Ω同轴电缆。前者主要用于**`传送基带数字信号`**，又称为**`基带同轴电缆`**，在局域网中广泛应用；后者主要用于**`传送带宽信号`**，又称为**`带宽同轴电缆`**，主要用于有线电视系统
  	![image-20231129222857714](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231129222857714.png)

  二者的比较：
  	由于外导体屏蔽层的作用，**`同轴电缆抗干扰特性比双绞线`**好，被广泛用于传输较高速率的数据，其传输距离更远，但加个较双绞线贵
  3、光纤：利用光导纤维传递光脉冲类进行通信。光纤通信系统的**`带宽远远大于`**目前其他各种传输媒体的带宽，利用了全反射原理
  	特点：
  		1、传输**`损耗小`**、中继距离长，对远距离传输特别经济
  		2、抗雷电和电磁干扰性能好
  		3、无串音干扰，**`保密性好`**，也不易被窃听或截取数据
  		4、体积小，重量轻

- 非导向型传输介质：自由空间，介质可以是空气、真空、海水等
  1、无线电波：向**`所有方向`**传播。较强穿透能力，可传远距离，广泛用于通信领域(手机通信等)
  2、微波：信号**`固定方向`**传播。微波通信频率高、频段范围宽，因此数据率很高

  ​	卫星通信：
  ​		优点：通信容量大、距离远、覆盖广、广播通信和多址通信
  ​		缺点：传播时延长、受气候影响大、误码率较高、成本高
  3、红外线、激光：信号**`固定方向`**传播。把要传输的信号分贝转换为各自的信号格式，然后再在空间中传播

## 物理层设备

### 中继器

诞生原因：由于存在损耗，在线路上传输的信号功率会逐渐衰减，衰减到一定程度时将造成信号失真，因此会导致接收错误

中继器功能：对**`数字信号`**进行**`再生和还原`**，对衰减的信号进行放大，保持与原数据相同，以增加信号传输的距离，延长网络的长度

中继器的两端：
	1、两端的网络部分时网段，而不是子网，适用于完全相同的两类网络的互连，且**`两个网段速率要相同`**
	2、中继器只将任何电缆段上的数据发送到另一段电缆上，它仅作用于信号的电气部分，并不管数据中是否有错误数据或不适于网段的数据
	3、两端可连相同媒体，也可连不同媒体
	4、中继器**`两端的网段一定要是同一个协议`**(中继器不会存储转发)

5-4-3规则：5：只能有最多不超过5个网段；4：最多有4个物理层的网络设备；3：只有三个段可以挂接计算机

### 集线器(多口中继器)

**`再生，放大信号`**

对信号进行**`再生放大转发`**，对衰减的信号进行放大，接着转发到其他所有(除输入端口外)处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。不具备信号的定向传送能力，是一个共享式设备

集线器不能分割冲突域，连载集线器上的工作主机平分带宽

## 疑难点

`什么是基带传输、频带传输、宽带传输，三者的区别是什么`

```
基带传输：在计算机内部或在相邻设备之间近距离传输时，可以不经过调制就在信道上直接进行的传输方式，适用于局域网
	数字基带传输就是在信道中直接传输数字信号，且传输媒体的整个带宽都被基带信号占用，双向的传输信息
	常用的编码方法有不归零编码和曼彻斯特编码
频带传输：用数字信号对特定频率的载波进行调制，将其变成适合于传送的信号后再进行传输
	远距离传输或无线传输时，数字信号必须用频带传输技术进行传输
	可以实现多路复用，进而提高传输信道的利用率
宽带传输：借助频带传输，可将链路容量分解成两个或多个信道，每个信道可以携带不同的信号
	所有的信道能同时互不干扰地发送信号，链路容量大大增加
```

`什么时同步通信和异步通信`

```
同步通信的通信双方必须线建立同步，即双方的时钟要调整到同一个频率。收发双方不停地发送和接收连续的同步比特流
	全网同步：用一个非常精确的主时钟对全网所有结点上的时钟进行同步
	准同步：各结点的时钟之间允许有微小的误差，然后采用其他措施实现同步传输
	同步通信数据率较高，但实现的代价也较高
异步通信再发送字符时，所发送的字符之间的时间间隔可以时任意的，但接收端必须时刻做好接收的准备。发送端可以再任意时刻开始发送字符。因此必须在每个字符开始和结束的地方加上标志，即开始位和停止位，以便使接收端能够正确的将每个字符接受先来
	异步通信可以以帧为单位
	通信设备简单、便宜，但传输效率较低(因为标志的开销所占比例较大)
```

# 数据链路层

## 考纲内容

- 数据链路层的功能
- 组帧(成帧)
- 差错控制
  检错编码；纠错编码
- 流量控制于可靠传输机制
  流量控制、可靠传输与滑动窗口机制；停止-等待协议
  后退N帧协议(GBN)；选择重传协议(SR)
- 介质访问控制
  1、信道划分：频分多路复用、时分多路复用、波分多路复用、码分多路复用的概念和基本原理
  2、随机访问：ALOHA协议；CSMA协议；CSMA/CD协议；CSMA/CA协议
  3、令牌传递协议
- 局域网
  局域网的基本概念与体系结构；以太网与IEEE802.3
  IEEE802.11无线局域网；VLAN基本概念与基本原理
- 广域网
  广域网的基本概念；PPP协议
- 数据链路层设备
  局域网交换机及其工作原理

**`考察重点`**。要求在了解数据链路层基本概念和功能的基础上，重点掌握华东窗口机制、三种可靠传输协议、各种MAC协议、HDLC协议和PPP协议，特别是CSMA/CD协议和以太网帧格式，以及局域网的争用期和最小帧长的概念、二进制指数退避算法。此外、中继器、网卡、集线器、网桥和局域网交换机的原理及区别也要重点掌握

## 数据链路层基本概念

结点：主机、路由
链路：网络中两个结点之间的**`物理通道`**，链路的传输介质主要有双绞线、光纤和微波、分为有限链路、无线链路
数据链路：网络中两个结点之间的**`逻辑通道`**，吧实现控制数据传输协议的硬件和软件加到链路上就构成数据链路
帧：链路层的协议数据单元，封装网络层数据报

数据链路层**`负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报`**

## 数据链路层的功能

数据链路层在物理层提供服务的基础上向网络层提供服务，其**`最基本的服务`**是**`将源自网络层来的数据可靠地传输到相邻结点的目标机网络层`**
主要作用：加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为**`逻辑上无差错的数据链路`**，使之对网络层表现为一条无差错的链路

1、**`为网络层提供服务`**。无确认无连接服务，有确认无连接服务，有确认面向连接服务
2、**`链路管理`**，即连接的建立、维持、释放(**`用于面向连接的服务`**)
3、**`组帧`**
4、**`流量控制`**
5、**`差错控制`**(帧错、位错)

### 为网络层提供服务

- 无确认的无连接服务（一般用于**`通信质量好`**，**`有线`**传输链路）
  源机器发送数据帧时**`不需要建立链路连接`**，目的机器收到数据帧时**`不需发回确认`**
  对**`丢失的帧`**，数据链路层不负责重发而交给**`上层处理`**
  **`适用于实时通信或误码率较低的通信信道`**，如以太网
- 有确认的无连接服务（一般用于**`通信质量差`**，**`无线`**传输链路）
  源机器发送数据帧时**`不需先建立链路连接`**，但目的机器收到数据帧时**`必须发回确认`**
  源机器**`在所规定的时间内未收到确定信号时，就要重传丢失的帧，以提高传输可靠性`**
  该服务**`适用于误码率较高的通信信道`**，如无线通信
- 有确认的面向连接服务（一般用于**`通信质量差`**，**`无线`**传输链路）
  帧传输过程分为三个结点：**`建立数据链路、传输帧、释放数据链路`**
  目的机器对收到的**`每一帧都要给出确认`**，源机器**`收到确认后才能发送下一帧`**
  该服务的**`可靠性最高`**，适用于通信要求(可靠性、实时性)较高的场合

注：`有连接就一定要有确认，即不存在无确认的面向连接的服务`
；

### 链路管理

数据链路层连接的**`建立、维持和释放`**过程称为链路管理，它主要用于**`面向连接的服务`**。链路两端的结点要进行通信，必须首先确认对方已处于就绪状态，并交换一些必要的信息以对帧序号初始化，然后才能建立连接，在传输过程中则要能维持连接，而在传输完毕后要释放该连接
在多个站点共享同一物理信道的情况下(如在局域网中)如何在要求通信的站点间分配和管理信道也属于数据链路层管理的范畴

### 组帧(封装成帧)

两台主机之间传输信息时，必须将网络层的分组组装成帧，以帧的形式进行传送。将一端数据的前后分别**`添加首部和尾部`**，就构成了帧

**`封装成帧`**就是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能**`根据首部和尾部的标记`**，从收到的比特流中**`识别帧的开始和结束`**

首部和尾部包含许多的控制信息，它们的一个重要作用就是**`帧定界`**(**`确定帧的界限`**)

**`帧同步`**：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止

为了**`提高帧的传输效率`**，应当**`使帧的数据部分的长度尽可能地大于首部和尾部的长度`**
但每种数据链路层协议都规定了**`帧的数据部分的长度`**：**`最大传送单元(MTU)`**

![image-20231130193622979](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231130193622979.png)

**`透明传输`**：指不管所传是什么样的比特组合，都应当能够在链路上传送。因此链路层就看不见有什么妨碍数据传输的东西
当所传输中的比特组合恰巧与某一个控制信息完全一致时，就必须采取适当的措施，使收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输时透明的

**组帧的四种方法**

1、字符计数法

帧首部使用一个计数字段来标明帧内字符数
目的结点的数据链路层收到字节计数时，就知道后面跟随的字节数，从而可以确定帧结束的位置
技术字段提供的字节数包含自身所占用的一个字节

![image-20231130205421640](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231130205421640.png)

缺点：如果**`技术字段出错`**，即**`失去了帧边界划分的依据`**，那么接收方就无法判断所传输帧的结束位和下一帧的开始位，收发双方将失去同步，从而造成灾难性后果

---

2、字符填充法

控制字符SOH放在帧的最前面，表示帧的首部开始
控制字符EOT表示帧的结束
不同协议会规定不同的SOH和EOT

当传送的帧是由文本文件组成时(文本文件的字符都是从键盘上输入的，都是ASCII码)。不管从键盘上输入什么字符都可以放在帧里传过去，即**`透明传输`**
当传送的帧是由非ASCII码的文本文件组成时(二进制代码的程序或图像等)。就要**`采用字符填充方法实现透明传输`**

为了使信息位中出现的特殊字符不被误判为帧的收尾定界符，可在特殊字符前面填充一个转移字符(ESC)来加以区分，以实现数据的透明传输。**`接收方收到转义字符后，就知道其后面紧跟的是数据信息，而不是控制信息`**
如果转义字符ESC也出现在数据中，那么解决方法仍是在转移字符前插入一个转移字符

![image-20231130211258157](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231130211258157.png)

---

3、零比特填充法

零比特填充法允许数据帧包含任意个数的比特，也允许每个字符的编码包含任意个数的比特

使用一个特定的比特模式，即**`01111110`**来标志一帧的开始和结束

![image-20231130211924478](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231130211924478.png)

为了不使信息位中出现的比特流被误判为帧的首尾标志
发送方的数据链路层在信息位中遇到5个连续的1时，将自动在其后插入一个0
而接收方每收到5个连续的1时，自动删除后面紧跟的0，以恢复原信息

![image-20231130211900194](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231130211900194.png)

保证了透明传输：在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误

优点：零比特填充法很容易由硬件来实现，性能优于字符填充法

---

4、违规编码法

在物理层进行比特编码时，通常采用违规编码法，如：

曼彻斯特编码方法将数据比特`1`编码成`高-低`电平对，将数据比特`0`编码成`低-高`电平对，而`高-高`和`低-低`电平对在数据比特中是违规的(**`没有采用`**)。可以借用这些违规编码序列来定界帧的起始和终止

违规编码法不需要采用任何填充技术，便能实现数据传输的透明性，但它**`只适用于采用冗余编码的特殊编码环境`**

---

**`由于字符计数法中计数字段的脆弱性和字符填充法实现上的复杂性与不兼容性，目前较常用的组帧方法是零比特填充法和违规编码法`**

### 差错控制

由于信道噪声等各种因素，帧在传输过程中可能会出现错误。用以是发送方确认接收方是否正确收到由其发送的数据的方法称为差错控制。

全局性：由于线路本身电气特性所产生的**`随机噪声`**(热噪声)，是信道固有的，随机存在的
	解决办法：提高信噪比来减少或避免干扰
局部性：外界特定的短暂原因所造成的**`冲击噪声`**，是产生差错的主要原因
	解决办法：通常利用编码计数来解决

通常这些错误可分为**`位错和帧错`**

**`位错`**：指帧中某些位出现了差错，1变0，0变1
	常采用**`循环冗余校验(CRC)方式`**发现位错，通过**`自动重传请求方式(ARQ)`**来重传出错的帧
	让发送方将要发送的数据帧附加一定的CRC冗余检错码一并发送，接收方则根据检错码对数据帧进行错误检测，或发现错误则丢弃，发送方超时重传该数据帧
	自动重传请求方式只需返回很少的控制信息就可有效地确认所发帧数据是否被正确接收

**`帧错`**：指帧的丢失、重复或失序等错误
	在数据链路层引入**`定时器和编号机制`**，能保证每一帧最终都能有且仅有一次正确地交付给目的结点

通常利用编码技术进行差错控制，主要有两类：**`自动重传请求ARQ`**和**`向前纠错FEC`**
在ARQ方式中，接收端检测到差错时，就设法通知发送端重发，直到接收到正确的码字为止
在FEC方式中，接收端不但能发现差错，而且能确定比特串的错误位置，从而加以纠正

综合以上，差错控制可以分为两种：**`检错编码和纠错编码`**

数据链路层编码和物理层的数据编码与调制不同
**`物理层编码`**针对的是**`单个比特`**，解决传输过程中比特的同步等问题，如曼彻斯特编码
**`数据链路层编码`**针对的是**`一组比特`**，通过**`冗余码技术`**实现一组二进制比特串在传输过程是否出现了差错

**1、检错编码**

检错编码都**`采用冗余编码技术`**

冗余码核心思想：在有效数据(信息位)被发送前，先按某种关系附加一定的冗余位，构成一个符合某一规则的码字后再发送。当要发送的有效数据变化时，相应到冗余位也随之变化，使得码字遵从不变规则。接收端根据收到的码字是否仍符合原规则来判断是否出错。常见的检错编码有**`奇偶校验码和循环冗余码`**

---

**奇偶校验码**：是奇校验码和偶校验码的统称，是一种最基本的检错码
包含有**`n - 1`**位信息元和**`1`**位校验元

根据**`比特串中1的个数`**是奇数还是偶数分为奇校验码和偶校验码
若一串编码中1的位数为偶数个，采用奇校验码，则在末尾添加一位1；若为奇数个，则在末尾添加一位0
若一串编码中1的位数为奇数个，采用偶校验码，则在末尾添加一位1；若为偶数个，则在末尾添加一位0

特点：**`只能检查出奇数个比特错误`**，检错能力为50%

---

**循环冗余码CRC**：又称为多项式码，任何一个由二进制数位串组成的代码都可与一个只含有0和1两个系数的多项式建立一一对应关系

一个k位帧可以视为从 **X^k-1^** 到 **X^0^** 到k次多项式的系数序列，这个多项式的阶数位**`k-1`**
给定一个m bit的帧或报文，发送器生成一个r bit的序列，称为帧检验序列(FCS)这样所形成的帧将由**`m+r`**比特组成
发送方和接收方实现商定一个多项式**`G(x)`**（最高位和最低位必须为1），使这个带检验码的帧**`刚好`**能被预先确定的多项式G(x)**`整除`**
接收方用相同的多项式去除收到的帧，如果**`无余数，那么认为无差错`**

假设一个帧有m位，其对应的多项式为M(x)，则计算冗余码的步骤如下：

-   加0。假设G(x)的阶为r，在帧的**`低位端加上r个0`**
-   模2除。利用模2除法，用G(x)对应的数据串去除上一步中计算出的数据串，**`得到的余数即冗余码`**(共r位)

注：多项式以2为模运算，实际上是每位对应的**`异或操作`**

在数据链路层仅仅使用循环冗余校验码CRC差错检测技术，**`只能做到对帧的无差错接收`**，即“凡是接收端数据链路层接受的帧，我们都能认为这些帧在传输过程中没有产生差错”。接收端丢弃的帧虽然曾收到了，但是最终还是因为有差错被丢弃，即未被接受

注：**`循环冗余码(CRC)是具有纠错功能`**的，只是**`数据链路层仅使用了它的检错功能`**，检测到帧出错则直接丢弃，是为了**`方便协议的实现`**

**2、纠错编码**

在数据通信的过程中，解决差错问题的一种方法是在每个要发送的数据块上附加足够的冗余信息，使接收方能够推导出发送方实际送出的应该是什么样的比特串

最常见的纠错编码是**`海明码`**，其实现原理是在有效信息位中加入几个校验位形成海明码，并把海明码的每个二进制位分配到奇偶校验组中。**`当某一位出错后，就会引起有关的几个校验位的值发生变化`**

这不但**`可以发现错误`**，而且**`能指出错位的位置`**，为自动纠错提供依据

海明距离(码距)：两个合法编码(码字)的对应比特取值不同的比特数称为这两个码字的海明距离，一个有效编码集中，任意两个合法编码的海明距离的最小值称为该编码集的海明距离

---

**海明码**

下面以数据码**`1010`**为例讲述海明码的编码原理和过程

-   确定海明码的位数
    设**`n`**为有效信息的位数，**`k`**为校验位的位数，则信息位n和校验位k应满足：
    		**n+k<=2^k^-1**		(若要检测两位错，则需再增加1位校验位，即k+1位)
    海明码位数为 n+k=7<=2^3^-1 成立，则n、k有效。设信息位为 **D~4~D~3~D~2~D~1~** (1010)，共4位，校验位为 **P~3~P~2~ P~1~** ，共3位，对应的海明码位 **H~7~H~6~H~5~H~4~H~3~H~2~H~1~** 

-   确定校验位的分布
    规定校验位 **P~i~** 在海明位号为 **2^i-1^** 的位置上，其余各位为信息位，即有：

    ​		P~1~ 的海明位号为：2^i-1^ = 2^0^ = 1，即H~1~为P~1~
    ​		P~2~ 的海明位号为：2^i-1^ = 2^1^ = 2，即H~2~为P~2~
    ​		P~3~ 的海明位号为：2^i-1^ = 2^2^ = 4，即H~4~为P~3~
    将信息位按原来的顺序插入，则海明码各位的分布如下：
    ​		H~7~	H~6~	H~5~	H~4~	H~3~	H~2~	H~1~
    ​		D~4~	D~3~	D~2~	P~3~	D~1~	P~2~	P~1~

-   分组以形成校验关系
    每个数据位用多个校验位进行校验，但要满足条件：波黑校验数据的海明位号等于校验该数据位的各校验位海明位号之和。另外，校验位不需要再被校验。分组形成的校验关系如下：
    ![image-20231205223744223](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231205223744223.png)

-   校验位取值
    校验位 **P~i~** 的值为第**`i`**组(由该校验位校验的数据位)所有位求异或
    ![image-20231205223843827](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231205223843827.png)
    所以，1010对应的海明码位  101**0**0**10**（加粗的位校验位，其他为信息位)

-   海明码的校验原理
    每个校验组分别利用校验位和参与形成该校验位的信息位进行奇偶校验检查，构成k个校验方程：
    ![image-20231205224005366](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231205224005366.png)
    若 **S~3~S~2~S~1~** 的值为**`000`**，则说明无错；否则说明出错，且这个数就是错误位的位号
    如：001，说明第1位出错，即 **H~1~** 出错，直接将该位取反就到达了纠错的目的

### 流量控制

较高的发送速率和较低的接收能力的不匹配，会造成传输出错，因此流量控制也是数据链路层的一项重要工作
流量控制涉及对链路上的帧的**`发送速率的控制`**，以使接收方有足够的缓冲空间来接收每个帧
流量控制的基本方法是**`由接收方控制发送方发送数据的速率`**，常见的方式有两种：**`停止-等待协议和滑动窗口协议`**

数据链路层的流量控制与传输层流量控制的对比：

```
数据链路层的流量控制是点对点的
传输层的流量控制是端到端的
数据链路层流量控制手段：接收方收不下就不回复确认
传输层流量控制手段：接收端给发送端一个窗口公告
```

**流量控制的方法**

**1、停止-等待协议**

每发送一个帧就停止发送，等待接收方的应答信号，在收到确认后才能发送下一个帧；接收方每接收一帧，都要反馈一个应答信号，表示可接收下一帧，如果接收方不反馈应答信号，那么发送方必须一直等待

在停止-等待协议中，除数据帧丢失外，还可能出现以下两种差错：

-   **`到达目的站的帧可能已遭破坏`**。源站有计时器，在一个帧发送后，源站等待确认，若在计时器满时仍未收到确认，就再次发送相同的帧。重复发送，直到该数据帧无错误的到达为止
-   **`数据帧正确而确认帧(ACK)被破坏`**。此时接收方已收到确认的数据帧，但发送方收不到确认帧，因此发送方会**`重传已被接收的数据帧`**，接收当收到同样的数据帧时会丢弃该帧，并重传一个该对应的确认帧。收到的确认帧有误时，重传已发送的帧

若连续出现相同**`发送序号的数据帧`**，表明发送端进行了**`超时重传`**
若连续出现相同**`序号的确认帧`**时，表明接收端收到了**`重复帧`**

发送端在发送完数据帧时，**`必须在其发送缓存中保留此数据帧的副本，这样才能在出差错时进行重传`**。只有**`在收到对方发来的确认帧时，才能清除此副本`**

![image-20231206204410796](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231206204410796.png)

特点：每次只允许发送一帧，然后就陷入等待接收方确认信息的过程中，因而**`传输效率很低，信道利用率很低`**

**2、滑动窗口协议**

发送窗口：在任意时刻，发送方都**`维持一组连续的允许发送的帧的序号`**
接收窗口：接收方同一时刻也**`维持一组连续的允许接收帧的序号`**

**`发送窗口用来对发送方进行流量控制`**，而发送窗口的大小 **W~t~** 代表在还**`未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧`**
同理，在接收端设置接收窗口是为了**`控制可以接收哪些数据帧和不可以接收哪些帧`**

在接收方，只有收到的数据帧的序号**`落入接收窗口内`**时，才允许**`将该数据帧收下`**。若接收到的数据帧**`落在接收窗口之外`**，则一律**`将其丢弃`**

发送端**`每收到一个确认帧`**，发送窗口就**`向前滑动一个帧的位置`**，当发送窗口内**`没有可以发送的帧时`**(即窗口内的帧全都是已发送但未收到确认的帧)，发送方就会**`停止发送`**，直到**`收到接收方发送的确认帧使窗口移动`**，窗口内有可以发送的帧后，才开始**`继续发送`**
接收端收到数据帧后，将窗口向前移一个位置，并发回确认帧，若**`收到的数据帧落在接收窗口之外，则一律丢弃`**

---

**后退N帧协议（GBN）**

发送方无须在收到上一个帧的ACK后才能开始发送下一帧，而是**`可以连续发送帧`**
当接收方**`检测出失序的信息帧`**后，要求发送方**`重发一个正确接收的信息帧之后的所有未被确认的帧`**

或者当发送方发送了N个帧后，若发现**`该N个帧的前一个帧在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失`**，此时发送方就不得不**`重传该出错帧及随后的N个帧`**。换句话说，**`接收方只允许按顺序接收帧`**

源站向目的站发送数据帧。每发送完一帧要为该帧设置超时计时器

由于连续发送了许多帧，所以确认帧必须要指明是对哪一帧进行确认
为了**`减少开销`**，GBN协议还规定接收端不一定每收到一个正确的数据帧就必须立即发回一个确认帧，而可以在连续收到好几个正确的数据帧后，才**`对最后一个数据发确认信息`**，或者可**`在自己有数据要发送时才将对以前正确收到的帧加以捎带确认`**

**`累积确认`**：对某一数据帧的确认就表明该数据帧和此前所有的数据帧均已正确无误地收到

后退N帧协议的**`接收窗口为1`**，可以**`保证按序接收数据帧`**。若采用n比特对帧编号，则其发送窗口的尺寸 **W~t~** 应满足：

​		**1 < W~t~ ≤ 2^n^ - 1**

若发送窗口的尺寸**大于2^n^ - 1**，则会造成**`接收方无法分辨新帧和旧帧`**

![image-20231206210102753](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231206210102753.png)

特点：一方面因**`连续发送数据帧而提高了信道的利用率`**；另一方面**`在重传时又必须把原来已传送正确数据帧进行重传，使得传送效率降低`**。若信道的传输质量很差导致**`误码率较大`**时，后退N帧协议**`不一定会优于`**停止-等待协议

---

**选择重传协议（SR）**

在选择重传协议中，每个发送缓冲区对应一个计时器，当计时器超时时，缓冲区的帧就会重传

另外，该协议使用的策略为：一旦接收方怀疑帧出错，就会发一个**`否定帧NAK`**给发送方，要求发送方**`对NAK中制定的帧进行重传`**
选择重传协议的接收窗口尺寸 **W~R~** 和发送窗口尺寸大小 W~T~ 都**`大于1`**，**`一次可以发送或接收多个帧`**

在协议中，**`接收窗口和发送窗口的大小通常是相同的`**
（选择重传协议是对单帧进行确认，所以发送窗口**`大于`**接收窗口会**`导致溢出`**，发送窗口**`小于`**接收窗口**`没有意义`**）
且最大值都为序号范围的一半，若采用n比特对帧编号，则需要满足：
				**W~Tmax~ = W~Rmax~ = 2^n-1^**
若不满足该条件，当一个或多个确认帧丢失时，发送方就会超时重传之前的数据帧，但**`接收方无法分辨是新的数据帧还是重传的数据帧`**

![image-20231206210850158](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231206210850158.png)

特点：协议**`可以避免重复传送那些本已正确到达接收端的数据帧`**，但在接收端要设置具有相当容量的缓冲区来暂存那些未按序正确收到的帧。**`接收端不能接受窗口下届以下或窗口上界以上的序号的帧`**，因此**`所需缓冲区的数目等于窗口大小`**，而不是序号数目

---

滑动窗口协议特性特性：

-   只有接收窗口向前移动(同时接收方发送了确认帧)时，发送窗口才有可能(只有发送方收到确认帧后才一定)向前移动

-   从滑动窗口的概念看，停止-等待协议、后退N帧协议和选择重传协议只在发送窗口大小与接收窗口大小上有所差别：

    ​				停止-等待协议：发送窗口大小 = 1，接收窗口大小 = 1
    ​				后退N帧协议：发送窗口大小 > 1，接收窗口大小 = 1
    ​				选择重传协议：发送窗口大小 > 1，接收窗口大小 > 1

-   接收窗口的大小为1时，可保证帧的有序接收

-   数据链路层的滑动窗口协议中，窗口的大小在传输过程中是固定的

### 可靠传输（和流量控制密不可分）

数据链路层的可靠传输通常使用**`确认和超时重传`**两种机制来完成

确认是一种**`无数据的控制帧`**，这种控制帧使得接收方可以让发送方知道哪些内容被正确接收
超时重传是指**`发送方在发送某个数据帧后就开启一个计时器`**，在一定时间内如果没有得到发送的数据帧的确认帧，那么就重新发送该数据帧，直到发送成功为止

捎带确认：为了**`提高传输效率，将确认捎带在一个回复帧中`**

**`自动重传请求(ARQ)`**：通过**`接收方请求发送重传出错的数据帧来恢复出错的帧`**，是通信中用于处理信道所带来差错的方法之一
传统自动重传请求分为三种：**`停止等待ARQ、后退N帧ARQ、选择性重传ARQ`**。后两种协议是滑动窗口技术与请求重发技术的结合
由于窗口尺寸开到足够大时，帧在线路上可以连续地流动，因此又称其为连续ARQ协议

**`发送窗口的大小 ≤ 窗口总数 - 1`**

注：在数据链路层中**`流量控制机制和可靠传输机制是交织在一起的`**

---

**信道利用率**：信道的效率。信道效率时对发送方而言的，指的是发送方在一个发送周期的时间内，有效地发送数据所需要的时间占整个发送周期的比率

如：
**`发送周期T`**：发送方**`从开始发送数据到收到第一个确认帧为止`**
发送方**`在发送周期内共发送L比特的数据`**
发送方**`数据传输速率`**为**`C`**
发送方用于**`发送有效数据的时间`**为**`L/C`**

**`发送周期T = 第一个帧的传输时延 + 第一个帧的传播时延 + 确认帧的传输时延 + 确认帧的传播时延`**
当没有明确规定忽略哪个时间不计的情况下所有时延必须算上
一般**`T = (L/C)+2R`**即忽略确认帧的发送时延(因为确认帧比较短小)

**`信道利用率 = (L/C)/T`**

**`信道吞吐率 = 信道利用率 x 发送方的发送速率`**

## 信道划分介质访问控制

传输数据使用的两种链路：

-   点对点链路：两个相邻节点通过一个链路相连，没有第三者
    应用：ppp协议，常用于广域网
-   广播式链路：所有主机共享通信介质
    应用：早期的总线以太网、无线局域网，常用于局域网
    典型拓扑结构：总线型、星型(逻辑为总线型)

主要任务：为使用介质的每个结点隔离来自统一信道上其他结点所传送的信号，以**`协调结点的传输`**

介质访问控制子层：用来决定广播信道中信道分配的协议属于数据链路层的一个子层
介质访问控制：采取一定的措施，使得两对节点之间的通信不会发生互相干扰的情况

介质访问控制分为**`静态划分信道和动态分配信道`**

-   静态划分信道，即信道划分介质访问控制，分为频分多路复用FDM、时分多路复用TDM、波分多路复用WDM、码分多路复用CDM
-   动态分配信道又分为轮询介质访问控制，即令牌传递协议，和随机访问介质访问控制，分为ALOHA协议、CSMA协议、CSAM/CD协议、CSMA/CA协议

---

**信道划分介质访问控制**

将使用介质的每个设备与来自统一信道的其他设备的通信隔离开，把**`时域和频域`**资源合理地分配给网络上的设备

多路复用技术：把多个信号组合在一条物理信道上进行传输，使得多个计算机或中断设备共享信道资源，提高信道利用率

![image-20231210194119916](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210194119916.png)

采用多路复用技术可把多个输入通道的信息整合到一个复用通道中，在接收端把收到的信息分离出来栓送到对应的输出通道

信道划分的实质就是通过分时、分频、分码等方式把原来的一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，**`实际就是把广播信道转变为点对点信道`**

-   频分多路复用FDM
    用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽(频率带宽)资源
    ![image-20231210194419983](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210194419983.png)
    每个子信道分配的带宽可不相同，但它们的**`总和必须不超过信道的总带宽`**。另外，为了防止子信道之间的干扰，相邻信道之间需要加入“保护频带”
    **`充分利用传输介质带宽，系统效率较高；由于技术比较成熟，实现也比较容易`**

-   时分多路复用TDM
    将时间划分为一段段等长的时分复用帧(TDM帧)。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道
    TDM帧是在物理层传送的比特流所划分的帧，标志一个周期
    ![image-20231210194541293](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210194541293.png)

    ​		就某个时刻来看，时分多路复用信道上传送的仅是某一时刻设备之间的信号
    ​		就某段时间而言，传送的是按时间分割的多路复用信号
    当**`传送的帧比较少的时候`**，由于每一个用户都固定了占用信道的时间，所以会可能会**`导致传输时隙比较大，造成利用率很低`**

-   改进的时分复用—统计时分复用STDM
    ![image-20231210194740105](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210194740105.png)
    每一个STDM帧中的时隙小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，**`一个STDM帧满了就发出`**
    STDM帧不是固定分配时隙，而是**`按需动态分配时隙`**

-   波分多路复用WDM
    其实就是**`光的频分多路复用`**，在一根光纤中传输多种不同波长(频率)的光信号，由于波长(频率)不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来
    ![image-20231210194911273](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210194911273.png)
    由于光波处于频谱的高频段，**`有很高的带宽`**，因而可以实现多路的波分复用

-   码分多路复用CDM
    码分多路复用是**`采用不同的编码来区分各路原始信号的一种复用方式`**。与FDM和TDM不同，它**`即共享信道的频率，又共享时间`**
    码分多址(CDMA)是码分复用的一种方式
    1比特分为多个码片/芯片，每一个站点被制定一个唯一的m位的芯片序列，发送**`1时发送芯片序列`**(通常把0写成-1)；发送**`0时发送芯片序列反码`**
    ![image-20231210195034245](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195034245.png)
    流程：

    ​		1、多个站点同时发送数据的时候，要求各个站点芯片序列相互正交，规格化内积为0
    ​				![image-20231210195257333](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195257333.png)
    ​		2、两个向量到了公告信道上，线性相加
    ​				![image-20231210195306432](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195306432.png)
    ​		3、数据分离：个饼的数据和源站规格化内积
    ​				![image-20231210195313911](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195313911.png)
    码分多路复用技术具有**`频谱利用率高、抗干扰能力强、保密性强、语音质量好`**等优点，还可以减少投资和降低运行成本，**`主要用于无线通信系统，特别是移动通信系统`**

---

**随机访问介质访问控制**(争用型协议)：所有用户能根据自己的意愿**`随机地发送信息`**，**`占用信道全部速率`**

核心思想：胜利者通过争用获得信道，从而获得信息的发送权
各结点之间的**`通信既不共享时间也不共享空间`**。实质上是一种**`将广播信道转化为点到点信道的行为`**

动态分配信道：动态媒体接入控制/多点接入
特点：信道并非在用户通信时分配给用户
堆积访问介质访问：**`所有用户可随机发送信息，发送信息时占用全部带宽`**。随机性会导致不协调从而造成冲突

**1、ALOHA协议**

分为纯ALOHA协议和时隙ALOHA协议

-   纯ALOHA协议
    思想：**`不监听信道，不按时间槽发送，随机重发，想发就发`**
    ![image-20231210195647972](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195647972.png)
    如果发生冲突，接收方就会检测出差错，然后不予确认，发送方在一定时间内收不到确认就判断发生冲突
    解决冲突的方法：**`超时后等待一段随机事件再重传，直到发送成功为止`**
-   时隙ALOHA协议
    思想：把所有各站在时间上同步起来，并将时间划分为一段段等长的时隙，规定**`只能在每个时隙开始时才能发送一个帧`**。若发生冲突，则必须等到下一个时间开始时刻再发送。**`避免了用户发送数据的随意性，减少了数据产生冲突的可能性，提高了信道的利用率`**
    ![image-20231210195830610](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210195830610.png)

关于ALOHA要知道的事

```
1、纯ALOHA比时隙ALOHA吞吐量更低，效率更低
2、纯ALOHA想发就发，时隙ALOHA只有在时间片段开始时才能发
```

**2、CSMA协议**

CSMA即载波监听多路访问协议
CS：载波侦听/监听，每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据
MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上

协议思想：**`发送帧之前，监听信道，若信道空闲则发送完整帧；若信道忙则推迟发送`**

分为**`1-坚持CSMA、非坚持CSMA、p-坚持CSMA`**

-   1-坚持CSMA
    坚持指的是对于监听信道忙之后的坚持
    思想：**`如果一个主机要发送消息，那么它先监听信道`**
    **`空闲直接传输`**，不必等待；**`忙则一直监听，直到空闲马上传输`**；如果有冲突(一段时间内未收到肯定回复)，则**`等待一个随机长的时间再监听`**，重复上述过程
    优点：只要媒体空闲，站点马上发送，**`避免了媒体利用率肯定损失`**
    缺点：加入有两个或两个以上的站点有数据要发送，冲突不可避免。**`传播延迟对该协议的性能影响较大`**
-   非坚持CSMA
    非坚持指的是对于监听信道忙之后就不再继续监听
    思想：**`如果一个主机要发送消息，那么它先监听信道`**
    **`空闲直接传输`**，不必等待；**`忙则放弃监听，等待一个随机时间之后再进行监听`**
    优点：采用随机的重发延迟时间可以减少冲突发生的可能性
    缺点：可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低
-   p-坚持CSMA
    p-坚持指的是对于监听信道空闲的处理
    思想：**`如果一个主机要发送消息，那么它先监听信道`**
    **`空闲则以p概率直接传输`**，不必等待；**`概率1-p等待到下一个时间槽再传输`**；**`忙则持续监听直到信道空闲再以p概率发送`**；**`若冲突则等到下一个时间槽开始再监听并重复上述过程`**
    优点：既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间
    缺点：发生冲突后还是要坚持把数据帧发送完，**`会造成数据浪费`**

![image-20231210200511562](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210200511562.png)

**3、CSMA/CD协议**

CSMA/CD即载波监听多点接入/**`碰撞检测`**
CS：载波侦听/监听，每一个站点在发送数据之前以及发送数据时都要检测一下总线上是否有其他计算机在发送数据
MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上
CD：碰撞检测(冲突检测)，**`边发边监听`**，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据

工作流程：**`先听后发，边听边发，冲突停发，随机重发`**
CSMA/CD协议**`适用于总线形网络或半双工网络环境`**

**`传播时延对载波监听的影响`**

![image-20231210200702988](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210200702988.png)

最迟多久才能知道自己发送的数据没有和别人发生碰撞：

```
最多是两倍的总线端到端的传播时延2τ
总线的端到端往返传播时延
争用期/冲突窗口/碰撞窗口
只要经过2τ时间还没有检测到碰撞，就能肯定这次发送不会发生碰撞
```

如何确定碰撞后到重传时机将使用到**`阶段二进制指数规避算法`**

-   确定基本退避(推迟)时间为2τ
-   定义参数k，等于重传次数，但k不超过10，即**`k=min[重传次数, 10]`**。当重传次数不超过10，k等于重传次数；**`当重传次数大于10时，k就不再增大而一直等于10`**
-   从离散的整数集合 **[0, 1, … , 2^k-1^]** 中随机取出一个数r，重传所需要退避的时间就是r倍的基本退避时间，即2rτ
-   当重传达**`16次`**仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告

![image-20231210201017968](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231210201017968.png)

若连续多次发生冲突，就表明可能有较多的站参与争用信道。使用此算法可使**`重传需要推迟的平均时间随重传次数的增大而增大，因而减小发生碰撞的概率，有利于整个系统的稳定`**

**`最小帧长 = 总线传播时延 x 数据传输速率 x 2`**
即2τ x 数据传输速率

**`以太网规定最短帧长位64B`**，凡是长度小于64B的都是由于冲突而一场终止的无效帧，所以**`对于要传输的小于64B的帧`**需要在MAC子层中数据字段的**`后面加入一个整数字节的填充字段`**，以保证以太网的MAC帧的长度不小于64B

算法归纳如下：

```
1、准备发送：适配器从网络层获得一个分组，封装成帧，放入适配器的缓存
2、检测信道：若检测到信道空闲，它就开始发送这个帧。若检测到信道忙，它就持续检测直至信道上没有信号能量，然后开始发送这个帧
3、在发送过程中，适配器仍持续检测信道
	若发送成功：在争用期内一直未检测到碰撞，这个帧肯定能发送成功
	若发送失败：在争用期内检测到碰撞，此时立即停止发送，适配器执行指数退避算法，等待一段随机事件后返回到步骤2.若重传16次仍不能成功，则停止重传并向上报错
```

**4、CSMA/CA协议**

CSMA/CA即载波监听多点接入/**`碰撞避免`**
CSMA/CA**`主要用于无线局域网中`**。原因是无线局域网需要全面检测碰撞；另外还有**`隐蔽站`**，当A和C都检测不到信号，认为信道空闲时，同时向终端B发送数据帧，就会导致冲突

工作原理：

-   发送数据前，先检测信道是否空闲
-   空闲则发出RTS，RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息；信道忙则等待
-   接收端收到RTS后，将响应CTS
-   发送端收到CTS后，开始发送数据帧(同时预约信道：发送方告知其他站点自己要传多久数据)
-   接收端收到数据帧后，将用CRC来检验数据是否正确，正确则响应ACK帧
-   发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止(采用二进制指数退避算法来确定随机推迟时间)

CSMA/CD与CSMA/CA的异同

-   相同点：
    CSMA/CD与CSMA/CA机制都从属于CSMA的思路，其**`核心是先听再说`**。换言之，两个**`在接入信道之前都需要进行监听，当发现信道空闲后，才能进行接入`**

-   不同点：

    ​		1、**`传输介质不同`**：CSMA/CD用于总线式以太网(有线)，而CSMA/CA用于无线局域网(无线)
    ​		2、**`载波检测方式不同`**：因传输介质不同，因此二者检测方式也会不同
    ​		3、**`CSMA/CD检测冲突，CSMA/CA避免冲突`**，二者出现冲突后都会进行有上限的重传

-   总结：CSMA/CA协议的基本思想是在发送数据时先广播告知其他结点，让其他结点在某段时间内不要发送数据，以免出现碰撞；CSMA/CD协议的基本思想是发送前监听，边发送监听，一旦出现碰撞马上停止发送

---

**轮询访问介质访问控制**

信道划分介质访问控制(MAC)协议

```
基于多路复用技术划分资源
网络负载重：共享效率高，且公平
负载网络轻：共享效率低
```

随机访问MAC协议（**`只有这个会发生冲突`**）

```
用户根据意愿来发送信息，发送信息时可独占信道带宽
网络负载重：产生冲突开销
网络负载轻：共享信道效率高，单个结点可利用信道全部带宽
```

轮询访问MAC协议/轮流协议/轮转访问MAC协议

```
既不产生冲突，又要发送时占全部带宽
```

在轮询访问中，用户不能随机地发送信息，而要通过一个**`集中控制的监控站`**，**`以循环方式轮询每个结点，再决定信道的分配`**

**1、轮询协议**

主结点轮流邀请从属结点发送数据
问题：会有轮询开销；会有一定的等待延迟；会有单点故障即主结点故障

**2、令牌传递协议**

令牌：一个特殊格式的MAC帧，不含任何信息。**`控制信道的使用，确保同一时刻只有一个结点独占信道`**。在令牌环网上是没有碰撞的
每个结点都可以在一定的时间内(令牌持有时间)获得发送数据的权利，**`并不是无限制地持有令牌`**

问题：会有令牌开销；会有一定的等待延迟；单点故障

令牌传递协议应用于**`令牌环网`**(**`物理上是星型拓扑；逻辑上是环形拓扑`**)
**`采用令牌传送方式的网络常用于负载较重、通信量较大的网络中`**

## 局域网

**局域网基本概念和体系结构**

局域网：简称LAN，是指在某一区域内由多台计算机通过**`双绞线、同轴电缆`**等连接介质互联成的计算组，它们之间资源和信息共享。使用**`广播信道`**

特点：

-   覆盖的地理范围小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内
-   使用专门铺设的传输介质(双绞线、同轴电缆)进行联网，**`数据传输速率高(10Mb/s～10Gb/s)`**
-   **`通信延迟时间短，误码率低，可靠性较高`**
-   各站为**`平等关系`**，共享传输信道
-   多采用**`分布式控制和广播式信道`**，能进行广播和组播

决定局域网的主要要素为：**`网络拓扑、传输介质与介质访问控制方法`**。其中最重要的是**`介质访问控制方式`**，它**`决定着局域网的技术特性`**

**局域网拓扑结构**

-   星型拓扑
    ![image-20231211191846241](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211191846241.png)
    中心结点式控制中心，任意两个节点间的通信最多只需两步，**`传输速度快`**，并且**`网络构形简单、建网容易、便于控制和管理`**
    但是这种网络系统**`网络可靠性低`**。网络**`共享能力差`**，有**`单点故障问题`**
-   总线型拓扑
    ![image-20231211192019933](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211192019933.png)
    网络**`可靠性高`**、网络**`结点间响应速度快`**、**`共享资源能力强`**、设备投入量少、成本低、安装使用方便，**`当某个工作站结点出现故障时，对整个网络系统影响小`**
-   环形拓扑
    ![image-20231211192156385](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211192156385.png)
    系统中通信设备和线路比较节省
    **`有单点故障问题`**：由于环路是闭合的，所以**`不便于扩充`**，系统**`响应延时长`**，且信息**`传输效率相对较低`**
-   树型拓扑
    ![image-20231211192313735](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211192313735.png)
    易于拓展、易于隔离故障，也容易有单点故障

**局域网传输介质**

在**`有线`**局域网中常用的介质有：**`双绞线、同轴电缆、光纤`**
在**`无线`**局域网中常用的介质有：**`电磁波`**

**局域网介质访问控制方法**

-   CSMA/CD
    常用于总线型局域网，也用于树型网络
-   令牌总线
    常用于总线型局域网，也用于树型网络
    它是把总线型或树型网络中的各个工作站按一定顺序(如按接口地址大小)排列形成一个逻辑环
    只有令牌持有者才能控制总线，才有发送信息的权利
-   令牌环
    用于环形局域网，如令牌环网

**局域网的分类**

-   以太网
    **`以太网是应用最为广泛的局域网`**，包括标准以太网(10Mbps)、千兆以太网(1000Mbps)和10G以太网，它们都符合IEEE802.3系列标准规范
    **`逻辑拓扑为总线型，物理拓扑为星型或拓展星型`**
    **`使用CSMA/CD协议`**
-   令牌环网
    **`物理上采用了星型拓扑结构，逻辑上时环型拓扑结构`**
-   FDDI网(光纤分布式数据接口网)
    **`物理上采用了双环拓扑结构，逻辑上是环型拓扑结构`**
-   ATM网
    较新型的单元交换技术，使用53字节股额定长度的单元进行交换
-   无线局域网(WLAN)
    采用**`IEEE802.11`**标准

**IEEE802标准**

![image-20231211192824206](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211192824206.png)

**MAC子层和LLC子层**

IEEE802标准所描述的局域网参考模型**`只对应OSI参考模型的数据链路层与物理层`**，它**`将数据链路层划分为逻辑链路层LLC子层和介质访问控制MAC子层`**

![image-20231211192922389](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211192922389.png)

LLC负责**`识别网络层协议`**，然后对它们进行封装，**`为帧添加序号`**。LLC报头告诉数据链路层一旦帧被接收到时，应当对数据包做何处理。**`为网络层提供服务`**：**`无确认无连接、面向连接、带确认无连接、高速传送`**

MAC子层的主要功能包括**`数据帧的封装/卸载，帧的寻址何识别，帧的接收与发送，链路的管理，帧的差错控制`**等。MAC子层的存在**`屏蔽了不同物理链路种类的差异性`**

---

**以太网与IEEE802.3**

IEEE802.3标准是一种基带**`总线型`**的局域网标准。描述**`物理层和数据链路层的MAC子层的实现方法`**

以太网逻辑上采用**`总线型拓扑结构`**，以太网中的所有计算机共享同一条总线，**`信息以广播方式发送`**。为了保证数据通信的方便性和可靠性，以太网简化了通信流程并使用了**`CSMA/CD方式对总线进行访问控制`**。是当今现有局域网采用的最通用的通信协议标准

以太网在局域网各种技术中占统治性的地位：

```
造价低廉
是应用最广泛的局域网技术
比令牌环网、ATM网便宜，简单
满足网络速率要求：10Mb/s～10Gb/s
```

以太网的两个标准：

```
DIX Ethernet V2:第一个局域网产品(以太网)规约
IEEE802.3:IEEE802工作组制定的第一个IEEE的以太网标准
```

以太网采用两种措施以简化通信：

-   采用**`无连接的工作方式`**，不对发送的数据帧编号，也不要求接收方发送确认，即以太网尽最大努力交付数据，**`提供的是不可靠服务`**，对于差错的纠正则由高层完成
-   发送的数据都是用**`曼彻斯特编码的信号`**，每个码元的中间出现一次电压转换，接收端利用这种电压转换方便地把同步信号提取出来

**`关于以太网提供的无连接、不可靠的服务`**

```
无连接：发送方和接收方之间无“握手过程”
不可靠：不对发送方的数据帧编号，接收方不向发送方进行确认，差错帧直接丢弃，差错纠正由高层负责
以太网只实现无差错接收，不实现可靠传输
```

---

**以太网的传输介质与网卡**

![image-20231211193444296](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211193444296.png)

注：10BASE-T非屏蔽双绞线以太网拓扑结构为**`星型网`**，星型网中心为集线器，但使用集线器的以太网在**`逻辑上仍然是一个总线型网`**，属于一个冲突域，因此会**`采用CSMA/CD介质访问控制`**

另外，**`T表示采用双绞线`**

计算机与外界有局域网的连接是通过网络适配器(网卡)的。网卡上装有处理器和存储器，是工作在数据链路层的网络组件
网卡的重要功能就是进行数据的串并交换，不仅能实现与局域网传输介质之间的物理连接和电信号匹配，还**`涉及帧的发送与接收、帧的封装与拆封、介质访问控制、数据的编码与解码及数据缓存功能`**等

在局域网中，硬件地址又称为物理地址，或MAC地址。这个地址用于控制主机在网络上的数据通信
另外，网卡控制着主机对介质的访问，因此**`网卡也工作在物理层`**，因为它只关注比特，而不关注任何地址信息和高层协议信息

---

**以太网的MAC帧**

MAC地址：每个适配器有一个全球唯一的48位二进制地址，前24位代表厂家(由IEEE规定)，后24位厂家自己制定。常用6个十六进制数表示，如02-60-8c-e4-b1-21

由于总线上使用的是**`广播通信`**，因此网卡从网络上每收到一个MAC帧，首先要用硬件检查MAC帧中的MAC地址。**`如果是发往本站的帧，那么就收下，否则就丢弃`**

最常用的MAC帧是以太网V2的格式

![image-20231211193807308](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211193807308.png)

前导码：**`使接收端与发送端时钟同步`**。在帧前面插入的8字节可在分为两个字段：第一个字段共7个字节，是前同步码，用来快速实现MAC帧的比特同步；第二个字段是帧开始定界符，表示后面的信息就是MAC帧
地址：通常使用6字节地址
类型：2字节，**`指出数据域中携带的数据应交给哪个协议实体处理`**
数据：46～1500字节，包含高层的协议消息。由于CSMA/CD算法的限制，以太网必须满足最小长度要求64字节
校验码(FCS)：4字节，校验范围从目的地址段到数据段段末尾，**`算法采用32位循环冗余码(CRC)`**，不但需要检验MAC帧的数据部分，还要检验目的地址、源地址和类型字段，但不校验前导码

DIX与IEEE802.3的区别：

```
802.3用长度域替代了DIX中的类型域，指出数据域的长度
当长度/类型字段值小于0x0600时，数据字段必须装入LLC子层
```

---

**高速以太网**

速率到达或超过100Mb/s的以太网称为高速以太网

-   100BASE-T以太网
    在**`双绞线`**上传送100Mb/s基带信号的**`星型拓扑`**以太网
    使用**`CSMA/CD协议`**
    支持**`全双工和半双工`**，可在全双工方式下工作而无冲突
-   吉比特以太网
    在**`光纤或双绞线`**上传送1Gb/s信号
    使用**`CSMA/CD协议`**
    支持**`全双工和半双工`**，可在全双工方式下工作而无冲突
-   10吉比特以太网
    在**`光纤`**上传送10Gb/s信号
    只支持**`全双工`**，无争用问题

以太网是**`可扩展的、灵活的，易于安装，稳健型好`**

---

**IEEE802.11 无线局域网**

无线局域网可分为两大类：**`有固定基础设施的无线局域网`**和**`无固定基础设施的移动自组织网络`**
所谓“固定基础设施”，是指预先建立的、能覆盖一定地理范围的固定基站

-   有固定基础设施无线局域网
    802.11(通常被称为WIFI)使用**`星型拓扑`**，其中心称为**`接入点(AP)`**，在**`MAC层使用CSMA/CD协议`**
    规定无线局域网的最小构件为**`基本服务集(BSS)`**
    一个基本服务集包括一个接入点和若干移动站
    各站在本BSS内之间的通信，或与本BSS外部站的通信，都必须通过本BSS的AP
    一个BSS可以是孤立的，也可通过AP连接到一个分配系统(DS)，然后再连接到另一个基本服务集，就构成了一个扩展服务集(ESS)
    注：各AP之间的通信时使用**`有线传输`**的
    ![image-20231211194447018](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211194447018.png)
-   无固定基础设施无线局域网的自组织网络
    又称为自组网络，没有AP，而是由一些平等状态的移动站相互通信组成的临时网络
    **`各站之间地位平等，中间结点都为转发结点，因此都具备路由器的功能`**
    ![image-20231211194538360](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211194538360.png)

---

**802.11局域网的MAC帧**

802.11帧共有三种类型，即**`数据帧、控制帧和管理帧`**

![image-20231211194620564](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211194620564.png)

数据帧由以下三部分组成：

-   MAC首部，共30帧。帧的复杂性都在MAC首部
-   帧主体，即帧的数据部分，不超过2312字节。它比以太网的最大长度长很多
-   帧检验序列FCS是尾部，共4字节

MAC首部中最重要的是**`4个地址字段`**。其**`内容取决于帧控制字段中的“去往AP”和“来自AP”这两个字段的数值`**。下面给出两种常用情况

![image-20231211194724834](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211194724834.png)

地址1是直接接收数据帧的结点地址，地址2是实际发送数据帧的结点地址

---

**VLAN基本概念及基本原理**

传统局域网的局限

```
1、缺乏流量隔离
	及时把组流量局域化到一个单一交换机中，广播流量仍会跨越整个机构网络(ARP、RIP、DHCP协议)
2、管理用户不变
	如果一个主机在不同组间移动，必须改变物理布线，连接到新的交换机上
3、路由成本较高
	局域网内使用很多路由器花销较大
```

VLAN基本概念
即虚拟局域网，是一种将局域网内的设备划分成**`与物理位置无关`**的逻辑组的技术，这些逻辑组有某些共同的需求。每个VLAN是一个单独的广播域/不同的子网

VLAN的实现：

在以太网帧中插入一个**`4字节的标识符`**(插入在源地址字段和类型字段之间)，称为**`VLAN标签`**，**`用来指明发送该帧的计算机属于哪个虚拟局域网`**

![image-20231211194939170](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231211194939170.png)

-   假定A向B发送帧，交换机1根据帧首部的目的MAC地址，识别B属于本交换机管理的VLAN-10，因此就像在普通以太网汇总那样直接转发帧
-   假定A向E发送帧，交换机1必须把帧转发到交换机2，但在转发前，要插入VLAN标签，否则交换机2不知道应把帧转发给哪个VLAN。交换机2在向E转发帧之前，要拿走已插入到VLAN标签
-   假定A向C发送帧，因为这是在不同网络之间的通信，虽然A和C都连接到同一交换机，但是它们已经处在不同的网络中，需要通过上层的路由器来解决，也可以在交换机中嵌入专用芯片来进行转发，这样就在交换机中实现了第三层的转发功能

**`虚拟局域网只是局域网给用户提供的一种服务，并不是一种新型局域网`**

## 广域网

广域网(WAN)：通常跨接很大的物理范围。广域网是因特网的核心部分
任务：**`长距离运送主机所发送的数据`**
连接广域网结点交换机的链路都是**`高速链路`**
广域网的通信子网主要使用**`分组交换技术`**。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将分布在不同地区的局域网或计算机系统互联起来，**`达到资源共享的目的`**

![image-20231212202831548](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212202831548.png)

**广域网和局域网的区别与联系**

![image-20231212202853807](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212202853807.png)

广域网中的一个重要问题是路由选择和分组转发

**`路由选择协议负责搜索分组从某个结点到目的结点到最佳传输路由`**，以便构造路由表，然后从路由表再构造出转发分组的转发表。**`分组是通过转发表进行转发的`**

---

**PPP协议**

点对点协议是使用**`串行线路`**通信的**`面向字节的协议`**，该协议应用在直接连接两个结点的链路上

设计的目的主要是用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种助机、网桥和路由器之间简单连接的一种共同的解决方案
PPP协议是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般都是用PPP协议

**PPP协议的三个组成部分**

-   **`一个将数据报封装到串行链路`**(/同步串行/异步串行)**`的方法`**。IP数据报在PPP帧中就是其信息部分，这个信息部分的长度受最大传送单元(MTU)的限制
-   **`链路控制协议LCP`**：**`用于建立、配置、测试和管理数据链路(身份验证)`**
-   **`网络控制协议NCP`**：PPP可支持多种网络协议，每个不同的网络层协议都要一个相应的NCP来配置，**`为网络层协议建立和配置逻辑连接`**

**PPP协议的状态图**

![image-20231212203215368](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212203215368.png)

```
1、当线路处于静止状态时，不存在物理层连接
2、当线路检测到载波信号时，建立物理连接，线路变为建立状态。此时，LCP开始选项商定，商定成功后就进入身份验证状态
3、身份验证通过后，进入网络层协议状态。这时，采用NCP配置网络层，配置成功后，进入打开状态，然后就可以进行数据传输
4、当数据传输完成后，线路转为终止状态。载波停止后则回到静止状态
```

**PPP协议的帧格式**

![image-20231212203314534](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212203314534.png)

注：因为PPP是点对点的，并不是总线型，所以**`无需采用CSMA/CD协议，自然就没有最短帧`**

**PPP协议的特点**

-   PPP**`提供差错检测但不提供纠错功能`**，只能保证无差错接收(通过硬件进行CRC校验)。它是**`不可靠的传输协议，因此也不使用序号和确认机制`**
-   它**`仅支持点对点的链路通信`**，不支持多点线路
-   PPP**`只支持全双工链路`**
-   PPP的**`两端可以运行不同的网络层协议`**，但仍然可使用同一个PPP通信
-   PPP是**`面向字节的`**，当信息字段出现和标志字段一致的比特组合时，PPP有两种不同的处理方法：若PPP用**`在异步线路，则采用字符填充法`**；若PPP用在SONET/SDH等**`同步线路，则协议规定采用硬件来完成比特填充`**

---

***HDLC协议 （考纲删除)**

即高级数据链路控制协议，是一个在**`同步网上传输数据、面向比特的数据链路层协议`**
数据报文**`可透明传输`**，用于实现透明传输时**`0比特插入法`**易于硬件实现
采用**`全双工通信`**
所有帧**`采用CRC检验`**，**`对信息帧进行顺序编号，可防止漏收或重复，传输可靠性高`**

**HDLC的站**

分为主站、从站、复合站

-   主站：主要功能是**`发送命令(包括数据信息)帧、接收响应帧`**，并**`负责对整个链路的控制系统的初启、流程的控制、差错的控制、差错检测或恢复`**等
-   从站：主要功能是**`接收由主站发来的命令帧，向主站发送响应帧，并且配合主站参与差错恢复等链路控制`**
-   复合站：主要功能是**`既能发送，又能接受命令帧和响应帧，并且负责整个链路的控制`**

三种数据操作方式：**`正常响应方式、异步平衡方式、异步响应方式`**

**HDLC的帧格式**

![image-20231212204136138](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212204136138.png)

-   **信息帧**(第1位为0)：用来**`传输数据信息`**，或**`使用捎带技术对数据进行确认`**
-   **监督帧**(10)：用于**`流量控制和差错控制`**，执行**`对信息帧的确认、请求重发和请求暂停发送等功能`**
-   **无编号帧**(11)：用于**`提供对链路的建立、拆除等多种控制功能`**

PPP协议与HDLC的异同：

```
同：
	HDLC、PPP只支持全双工链路
	都可以实现透明传输
	都可以实现差错检测，但不纠正差错
异：
	PPP协议面向字节，有2B协议字段，且无序号和确认机制，传输不可靠
	HDLC协议面向比特，没有2B协议字段，有编号和确认机制，传输可靠
```

## 数据链路层设备

**网桥的基本概念**

两个或多个以太网通过网桥连接后，就成为一个覆盖范围更大的以外网，而**`原来的每个以太网就称为一个网段`**
网桥**`工作在链路层的MAC层`**，是可以**`使以太网各网段隔离开的碰撞域(又称冲突域)`**
如果把网桥换成工作在物理层的转发器，那么就没有这种过滤通信量的功能
由于**`各网段相对独立，因此一个网段的故障不会影响到另一个网段的运行`**
网桥`**必须具有路径选择的功能`**，接收到帧后，要决定正确的路径，将该帧转送到相应的目的局域网站点

网络1和网络2通过网桥连接后，网桥接收网络1发送到数据帧，检查数据帧中的地址
如果是网络2的地址，那么就转发给网络2
如果是网络1的地址，那么就将其丢弃
因为源站和目的站处在同一个网段，目的站能够直接收到这个帧而不需要借助网桥转发

```
物理层扩展以太网使用光纤或集线器
数据链路层扩展以太网使用网桥或交换机
```

**网桥的优点**

```
1、过滤通信量，增大吞吐量
2、扩大了物理范围
3、提高了可靠性
4、可互联不同物理层、不同MAC子层和不同速率的以太网
```

**透明网桥**

透明网桥：“透明”指以太网上的站点并不知道所发送的帧将经过哪几个网桥，是一种即插即用设备（自学习）

**源路由网桥**

源路由网桥：在发送帧时，把详细的最佳路由信息(路由最少/时间最短)放在帧的首部中
方法：源站以广播方式向欲通信的目的站发送一个发现帧

**冲突域和广播域**

冲突域：在同一个冲突域的每一个结点都能收到所有被发送的帧。简单的说就是**`同一时间内只有一台设备发送信息的范围`**
广播域：网络中能接收任一设备发出的广播帧的所有设备的集合。简单的说**`通过站点发出一个广播信号，所有能接收到这个信号的设备范围称为一个广播域`**

![image-20231212205040680](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212205040680.png)

---

**局域网交换机**

交换机的原理和特点

局域网交换机：即**`以太网交换机`**。实质上就是一种**`多端口的网桥，它工作在数据链路层`**
以太网交换机的`**每个端口都直接与单台主机或另一个交换机相连`**，通常都**`工作在全双工方式`**

交换机能经济地将网络纷争小的冲突域，为每个工作站提供更高的带宽
原理：检测从以太网端口来的数据帧的源和目的地的MAC(介质访问层)地址，然后与系统内部的动态查找表进行比较，若数据帧的源MAC地址不在查找表中，则将该地址加入查找表，并将数据帧发送给相应的目的端口

以太网交换机对工作站是透明的，因此管理开销低廉，简化了网络结点增加、移动和网络变化的操作
利用以太网交换机还可以方便地实现虚拟机局域网VLAN，VLAN**`不仅可以隔离冲突域，而且可以隔离广播域`**

**以太网交换机的特点**

-   以太网交换机的**`每个端口都直接与单台主机相连`**，并且一般都工作在**`全双工方式`**
-   以太网交换机**`能同时连接多对端口`**，使每对相互通信的主机都能像独占通信媒体那样，**`无碰撞地传输数据`**
-   以太网交换机是一种即插即用设备，其内部的帧的**`转发表是通过自学习算法自动地逐渐建立起来的`**
-   以太网交换机由于使用专用的交换结构芯片，**`交换速率较高`**
-   以太网交换机**`独占传输媒体的带宽`**

**以太网交换机主要采用两种交换模式**

-   **`直通式交换机`**：**`只检查帧的目的地址`**，这使得帧在接收后几乎马上被传出去。这种方式**`速度快，但缺乏智能性和安全性，也无法支持具有不同速率的端口的交换`**
-   **`存储转发式交换机`**：现将接收到的帧缓存到高速缓存器中，并检查数据是否正确，确认无误后通过查找表转换成输出端口将该帧发送出去。如果发现有错，那么就将其丢弃。**`优点是可靠性高，并能支持不同速率端口见的转换，缺点是延迟较大`**

**交换机的自学习功能**

决定一个帧是应该将其丢弃称为**`过滤`**。决定一个帧应该被移动到哪个接口称为**`转发`**
交换机的**`过滤和转发借助于交换表完成`**
交换表总的一个表项至少包含：一个MAC地址；连通该MAC地址的交换机端口

![image-20231212205648226](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212205648226.png)

**交换机的交换表初始是空的**

-   A先向B发送一帧，从端口1进入交换机
-   交换机收到帧后，查找到交换表，找不到MAC帧地址为B的表项
-   然后，交换机将该帧的源地址A和端口1写入交换表，并向除端口1外的所有端口广播这个帧
    C和D丢弃该帧，因为目的地址不对。只有B才收下这个目的地址正确的帧
-   交换表中写入（A，1）后，以后从任何端口收到目的地址为A的帧，都应该从端口1转发出去
    这是因为，既然A发出的帧从端口1进入交换机，那么端口1转发出去的帧也应能到达A
-   接下来，假定B通过端口3向A发送一帧，交换机查找交换表后，发现有表项（A，1），将该帧从端口1转发给A
    显然，此时已没有必要再广播收到的帧
    将该帧的源地址B和端口3写入交换表，表明以后如果发送给B的帧，应该从端口3转发出去
-   经过一段时间，只要主机C和D也想其他主机发送帧，交换机就会把C和D及对应的端口号写入交换表
    这样，转发给任何主机的帧，都能很快地在交换表中找到相应地转发端口

考虑到交换机所连到主机会随时变化，这就需要更新交换表中的表项。为此，交换表中的**`每个表项都设有一定的有效时间，过期的表项会自动删除`**。这就保证了交换表中的数据复合当前网络的实际状况

## 疑难点

`“链路”和“数据链路”有何区别？“电路接通”与“数据链路接通又何区别”？`

```
链路，是指从一个结点到相邻结点到一段物理线路，其中间没有其他任何的交换结点。在进行数据通信时，两台计算机之间的通信路径往往要经过许多段这样的链路。可见， 链路只是一条路径的组成部分

数据链路。在一条线路上传送数据时，除必须有一条物理 线路外，还必须有一些通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。有时也把链路分为物理链路和逻辑链路。物理链路就是指上面所说的链路，逻辑链路就是上面的数据链路，即物理链路加上必要的通信协议

电路接通，表示链路两端的结点交换机已经开机，物理连接已经能够传送比特流，但数据传输并不可靠

数据链路接通，在物理连接基础上，再建立数据链路连接。此后，由于数据链路连接具有检测、确认和重传功能，才使得不太可靠的物理链路变成可靠的数据链路， 进行可靠的数据传输。当数据链路断开连接时，物理电路连接不一定跟着断开连接
```

`数据链路层使用PPP协议或CSMA/CD协议时，既然不保证可靠传输，为什么要对所传输的帧进行差错检验？`

```
当数据链路层使用PPP协议或CSMA/CD协议时，在数据链路层的接收端对所传输的帧进行差错检验是为了不将已发现有差错的帧接收下来
如果在接收端不进行差错检测，那么接收端上交给主机的帧就可能包括在传输中出了差错的帧，而这样的帧对接收 端主机是没有用处的

换言之，接收端进行差错检测的目的是：上交主机的帧都是没有传输差错的，有差错的都已经丢弃了。凡是上交主机的帧都是没有传输差错的
```

`假定连接到透明网桥上的一台计算机把一个数据帧发给网络上的一个不存在的设备，网桥将如何处理这个帧？`

```
网桥不知道网络上是否存在该设备，它只知道在其转发表中没有这个设备的MAC地址。因此，当网桥收到这个目的地址位置的帧时，它将扩散该帧，即把该帧发送到所连接的除输入网段外的所有其他网段
```

`关于冲突域(碰撞域)和广播域辨析`

```
一块网卡发送信息时，只要有可能和另一块网卡冲突，那么这些可能冲突的网卡就构成冲突域。一块网卡发出一个广播时，能收到这个广播的所有网卡的集合称为一个广播域。一般来说，一个网段就是一个冲突域，一个局域网就是一个广播域
```

`关于物理层、数据链路层、网络层设备对于隔离冲突域和广播域的总结`

![image-20231212210605462](https://gitee.com/duxianQAQ/typora-image/raw/master/typora-image/image-20231212210605462.png)

`与传统共享式局域网相比，使用局域网交换机的交换式局域网为什么能改善网络的性能 和服务质量？`

```
传统共享式局域网的核心设备是集线器，而交换式局域网的核心是以太网交换机

在使用共享式集线器的传统局域网中，在任何时刻只能有一个结点能够通过共享通信信道发送数据
在使用交换机的交换式局域网中，交换机可以在它的多个端口之间建立多个并发连接，从而实现结点之间数据的并发传输，有效地改善网络性能和服务质量
```

`试分析中继器、集线器、网桥和交换机这四种网络互连设备的区别与联系`

```
这四种设备都是用于互连、扩展局域网的连接设备，但它们工作的层次和实现的功能不同

中继器工作在物理层，用来连接两个速率相同且数据链路层协议也相同的网段，其功能是消除数字信号在基带传输中由于经过一长段电缆而造成的失真和衰减，使信号的波形和强度达到所需的要求；其原理是信号再生

集线器也工作在物理层，相当于一个多接口的中继器，它可将多个结点连接成一个共享式的局域网，但任何时刻都只能有一个结点通过公共信道发送数据

网桥工作在数据链路层，可以互连不同的物理层、不同的MAC子层及不同速率的以太网。网桥具有过滤帧及存储转发帧的功能，可以隔离冲突域，但不能隔离广播域

交换机工作在数据链路层，相当于一个多端口的网桥，是交换式局域网的核心设备。它允许端口之间建立多个并行连接，实现多个结点之间的并行传输。因此，交换机的每个端口结点所占用的带宽不会因为端口结点数目的增加而减少，且整个交换机的总带宽会随着端口结点的增加而增加。交换机一般工作在全双工方式，有的局域网交换机采用存储转发方式进行转发，也有的交换机采用直通交换方式（即在收到帧的同时立即按帧的目的MAC地址决定该帧的转发端口，而不必先缓存再处理）。另外利用交换机可以实现虚拟局域网(VLAN)，VLAN不仅可以隔离冲突域，而且可以隔离广播域
```

`交换机和网桥的不同之处`

```
尽管交换机也称多端口网桥，但两者仍有许多不同之处：
1、网桥的端口一般连接局域网，而交换机的端口一般直接与局域网的主机相连
2、交换机允许多对计算机同时通信，而网桥仅允许每个网段上的计算机同时通信
3、网桥采用存储转发进行转发，而以太网交换机还可以采用直通方式进行转发，且以太网交换机采用了专用的交换结构芯片，转发速度比网桥快
```
